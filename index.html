<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
<title>CSVocab</title>
<link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQ1NWb2NhYiIsInNob3J0X25hbWUiOiJDU1ZvY2FiIiwic3RhcnRfdXJsIjoiLiIsImRpc3BsYXkiOiJzdGFuZGFsb25lIiwiYmFja2dyb3VuZF9jb2xvciI6IiNGRkY4RjAiLCJ0aGVtZV9jb2xvciI6IiNGRjhDMDAifQ==">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="CSVocab">
<link rel="apple-touch-icon" href="data:image/png;base64,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">
<meta name="theme-color" content="#FF8C00">
<link href="https://fonts.googleapis.com/css2?family=Zen+Maru+Gothic:wght@400;500;700;900&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
  --orange-50: #FFF8F0;
  --orange-100: #FFECD6;
  --orange-200: #FFD4A8;
  --orange-400: #FFA94D;
  --orange-500: #FF8C00;
  --orange-600: #E67A00;
  --orange-700: #CC6B00;
  --green-400: #4ADE80;
  --green-500: #22C55E;
  --green-600: #16A34A;
  --blue-400: #60A5FA;
  --blue-500: #3B82F6;
  --yellow-400: #FACC15;
  --yellow-500: #EAB308;
  --red-400: #F87171;
  --red-500: #EF4444;
  --gray-100: #F3F4F6;
  --gray-200: #E5E7EB;
  --gray-300: #D1D5DB;
  --gray-400: #9CA3AF;
  --gray-500: #6B7280;
  --gray-600: #4B5563;
  --gray-700: #374151;
  --gray-800: #1F2937;
  --gray-900: #111827;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.08);
  --shadow-md: 0 4px 12px rgba(0,0,0,0.1);
  --shadow-lg: 0 8px 30px rgba(0,0,0,0.12);
  --shadow-xl: 0 16px 50px rgba(0,0,0,0.15);
  --radius: 16px;
  --radius-sm: 10px;
}

body {
  font-family: 'Zen Maru Gothic', sans-serif;
  background: linear-gradient(145deg, #FFF5EB 0%, #FFF0E0 30%, #FFE8D0 100%);
  min-height: 100vh;
  min-height: 100dvh;
  color: var(--gray-800);
  overflow-x: hidden;
  -webkit-tap-highlight-color: transparent;
  -webkit-text-size-adjust: 100%;
  touch-action: manipulation;
}

body::before {
  content: '';
  position: fixed;
  top: -120px;
  right: -120px;
  width: 350px;
  height: 350px;
  background: radial-gradient(circle, rgba(255,140,0,0.12) 0%, transparent 70%);
  border-radius: 50%;
  z-index: 0;
}
body::after {
  content: '';
  position: fixed;
  bottom: -80px;
  left: -80px;
  width: 250px;
  height: 250px;
  background: radial-gradient(circle, rgba(255,169,77,0.1) 0%, transparent 70%);
  border-radius: 50%;
  z-index: 0;
}

.app {
  max-width: 480px;
  margin: 0 auto;
  padding: 20px 16px 100px;
  padding-top: calc(20px + env(safe-area-inset-top));
  padding-bottom: calc(100px + env(safe-area-inset-bottom));
  padding-left: calc(16px + env(safe-area-inset-left));
  padding-right: calc(16px + env(safe-area-inset-right));
  position: relative;
  z-index: 1;
}

/* Header */
.header {
  text-align: center;
  padding: 24px 0 20px;
}
.header h1 {
  font-size: 28px;
  font-weight: 900;
  color: var(--orange-600);
  letter-spacing: -0.5px;
}
.header h1 span { font-size: 32px; }
.header p {
  font-size: 13px;
  color: var(--gray-500);
  margin-top: 4px;
  font-weight: 500;
}
.header { position: relative; min-height: 40px; }
.header h1 { padding-right: 90px; }
.header-btns {
  position: absolute;
  top: 0;
  right: 0;
  display: flex;
  gap: 6px;
}
/* Import screen only has one button */
#screen-import .header {
  display: flex;
  justify-content: flex-end;
  min-height: 40px;
}
#screen-import .help-toggle {
  position: static;
}
.help-toggle {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: none;
  background: var(--gray-100);
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}
.sound-toggle {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: none;
  background: var(--gray-100);
  font-size: 20px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}
.sound-toggle.muted { opacity: 0.4; }

/* Help modal */
.help-modal {
  max-height: 80vh;
  padding: 0;
  overflow: hidden;
  display: flex;
  flex-direction: column;
}
.help-scroll {
  padding: 28px 22px;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  flex: 1;
  overscroll-behavior: contain;
}
.help-section {
  margin-bottom: 20px;
}
.help-section h3 {
  font-size: 15px;
  font-weight: 700;
  margin-bottom: 8px;
  color: var(--orange-600);
}
.help-section p {
  font-size: 13px;
  color: var(--gray-600);
  line-height: 1.7;
  margin-bottom: 6px;
}
.help-prompt {
  background: var(--gray-100);
  border-radius: 8px;
  padding: 10px 12px;
  font-size: 12px;
  color: var(--gray-700);
  margin: 6px 0;
  line-height: 1.5;
  font-style: italic;
}

/* Celebration */
.celebration-modal { text-align: center; }

/* Demo picker */
.demo-picker-modal { max-height: 80vh; }
.demo-list {
  display: flex;
  flex-direction: column;
  gap: 8px;
  max-height: 50vh;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}
.demo-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: var(--gray-50);
  border: 1.5px solid var(--gray-200);
  border-radius: 12px;
  padding: 14px 16px;
  font-family: inherit;
  font-size: 14px;
  font-weight: 600;
  color: var(--gray-700);
  cursor: pointer;
  transition: all 0.2s;
  text-align: left;
}
.demo-item:hover { border-color: var(--orange-400); background: var(--orange-50); }
.demo-item span {
  font-size: 12px;
  color: var(--gray-400);
  font-weight: 500;
  flex-shrink: 0;
}

/* Format tabs */
.format-tabs {
  display: flex;
  gap: 6px;
  margin-bottom: 10px;
  flex-wrap: wrap;
}
.format-tab {
  padding: 6px 12px;
  border-radius: 20px;
  border: 1.5px solid var(--gray-200);
  background: white;
  font-family: inherit;
  font-size: 12px;
  font-weight: 600;
  color: var(--gray-500);
  cursor: pointer;
  transition: all 0.2s;
}
.format-tab.active {
  background: var(--orange-500);
  color: white;
  border-color: var(--orange-500);
}

/* Screen transitions */
.screen { display: none; animation: fadeIn 0.3s ease; }
.screen.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

/* Import screen */
.import-area {
  background: white;
  border-radius: var(--radius);
  padding: 32px 24px;
  text-align: center;
  box-shadow: var(--shadow-md);
  border: 2px dashed var(--orange-200);
  cursor: pointer;
  transition: all 0.25s;
  position: relative;
  overflow: hidden;
}
.import-area:hover {
  border-color: var(--orange-400);
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}
.import-area.dragover {
  border-color: var(--orange-500);
  background: var(--orange-50);
}
.import-icon {
  width: 64px;
  height: 64px;
  margin: 0 auto 16px;
  background: var(--orange-100);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 28px;
}
.import-area h3 {
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 8px;
  color: var(--gray-800);
}
.import-area p {
  font-size: 13px;
  color: var(--gray-400);
  line-height: 1.6;
}
.import-area input { display: none; }

.format-hint {
  margin-top: 20px;
  background: var(--gray-100);
  border-radius: var(--radius-sm);
  padding: 16px;
  text-align: left;
}
.format-hint code {
  display: block;
  font-family: 'DM Sans', monospace;
  font-size: 13px;
  color: var(--gray-600);
  line-height: 1.8;
}

.demo-btn {
  margin-top: 16px;
  background: var(--orange-500);
  color: white;
  border: none;
  padding: 14px 28px;
  border-radius: 50px;
  font-family: inherit;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 4px 15px rgba(255,140,0,0.3);
}
.demo-btn:hover {
  background: var(--orange-600);
  transform: translateY(-1px);
  box-shadow: 0 6px 20px rgba(255,140,0,0.4);
}

/* ===== Deck Selector ===== */
/* Horizontal Deck Carousel */
.deck-carousel-section {
  margin-bottom: 12px;
}
.deck-carousel-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}
.deck-carousel-header h3 {
  font-size: 14px;
  font-weight: 700;
  color: var(--gray-500);
}
.deck-carousel-count {
  font-size: 12px;
  font-weight: 600;
  color: var(--gray-400);
}
.deck-carousel-vp {
  position: relative;
  overflow: hidden;
  -webkit-user-select: none;
  user-select: none;
  touch-action: pan-y;
  padding: 8px 0;
  margin: 0 -20px;
}
.deck-carousel-track {
  position: relative;
  height: 150px;
  will-change: contents;
}
.deck-card {
  flex-shrink: 0;
  width: 130px;
  margin: 0 6px;
  background: white;
  border-radius: 16px;
  border: 2.5px solid var(--gray-150, #E5E7EB);
  padding: 14px 8px 10px;
  text-align: center;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  transition: transform 0.35s cubic-bezier(.23,1,.32,1), opacity 0.35s, border-color 0.35s, box-shadow 0.35s;
  opacity: 0.4;
  transform: scale(0.85);
  cursor: pointer;
}
.deck-card.active {
  border-color: var(--orange-400);
  box-shadow: 0 4px 20px rgba(255,140,0,0.18), 0 0 0 1px var(--orange-200);
  opacity: 1;
  transform: scale(1);
}
.deck-card .dc-donut {
  width: 68px;
  height: 68px;
  margin: 0 auto 8px;
  position: relative;
}
.deck-card .dc-donut svg {
  width: 100%;
  height: 100%;
  transform: rotate(-90deg);
}
.dc-donut circle {
  fill: none;
  stroke-width: 7;
  stroke-linecap: round;
}
.deck-card .dc-donut-center {
  position: absolute;
  inset: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
}
.deck-card .dc-pct {
  font-size: 15px;
  font-weight: 800;
  color: var(--gray-700);
  line-height: 1;
}
.deck-card .dc-pct-label {
  font-size: 7px;
  color: var(--gray-400);
  margin-top: 1px;
}
.deck-card .dc-name {
  font-size: 12px;
  font-weight: 700;
  color: var(--gray-700);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  margin-bottom: 2px;
}
.deck-card.active .dc-name {
  color: var(--gray-800);
}
.deck-card .dc-meta {
  font-size: 10px;
  color: var(--gray-400);
}
/* Fade edges */
.deck-carousel-vp::before,
.deck-carousel-vp::after {
  content: '';
  position: absolute;
  top: 0; bottom: 0;
  width: 28px;
  z-index: 2;
  pointer-events: none;
}
.deck-carousel-vp::before {
  left: 0;
  background: linear-gradient(to right, var(--bg), transparent);
}
.deck-carousel-vp::after {
  right: 0;
  background: linear-gradient(to left, var(--bg), transparent);
}

/* Deck edit overlay */
.deck-edit-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 2000;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 24px;
  animation: fadeInOverlay 0.2s ease;
}
.deck-edit-overlay.show { display: flex; }
.deck-edit-modal {
  background: white;
  border-radius: 20px;
  padding: 24px 20px 20px;
  max-width: 340px;
  width: 100%;
  box-shadow: var(--shadow-xl);
  animation: modalPop 0.25s ease;
}
.deck-edit-modal h3 {
  font-size: 16px;
  font-weight: 900;
  color: var(--gray-800);
  text-align: center;
  margin-bottom: 16px;
}
.deck-edit-name-row {
  display: flex;
  gap: 8px;
  margin-bottom: 16px;
}
.deck-edit-name-row input {
  flex: 1;
  border: 2px solid var(--gray-200);
  border-radius: 10px;
  padding: 10px 12px;
  font-size: 14px;
  font-weight: 600;
  font-family: inherit;
  outline: none;
  transition: border-color 0.2s;
}
.deck-edit-name-row input:focus {
  border-color: var(--orange-400);
}
.deck-edit-name-row button {
  padding: 10px 16px;
  border: none;
  border-radius: 10px;
  background: var(--orange-500);
  color: white;
  font-size: 13px;
  font-weight: 700;
  cursor: pointer;
  font-family: inherit;
  white-space: nowrap;
  transition: all 0.2s;
}
.deck-edit-actions {
  display: flex;
  flex-direction: column;
  gap: 8px;
}
.deck-edit-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 14px 16px;
  border: none;
  border-radius: 12px;
  background: var(--gray-50);
  font-size: 14px;
  font-weight: 600;
  color: var(--gray-600);
  cursor: pointer;
  font-family: inherit;
  transition: all 0.15s;
  text-align: left;
}
.deck-edit-btn:hover { background: var(--gray-100); }
.deck-edit-btn:active { transform: scale(0.98); }
.deck-edit-btn .de-icon {
  font-size: 18px;
  width: 24px;
  text-align: center;
}
.deck-edit-btn.danger {
  color: var(--red-500);
}
.deck-edit-btn.danger:hover {
  background: #FEE2E2;
}

/* Reorder overlay */
.reorder-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 2000;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 24px;
  animation: fadeInOverlay 0.2s ease;
}
.reorder-overlay.show { display: flex; }
.reorder-modal {
  background: white;
  border-radius: 20px;
  padding: 20px 16px 16px;
  max-width: 360px;
  width: 100%;
  box-shadow: var(--shadow-xl);
  animation: modalPop 0.25s ease;
  max-height: 80vh;
  display: flex;
  flex-direction: column;
}
.reorder-modal h3 {
  font-size: 16px;
  font-weight: 900;
  color: var(--gray-800);
  text-align: center;
  margin-bottom: 4px;
}
.reorder-modal .reorder-hint {
  font-size: 12px;
  color: var(--gray-400);
  text-align: center;
  margin-bottom: 12px;
}
.reorder-list {
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  flex: 1;
  min-height: 0;
  border-radius: 12px;
  border: 1px solid var(--gray-100);
}
.reorder-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 12px;
  background: white;
  border-bottom: 1px solid var(--gray-100);
  transition: background 0.15s;
}
.reorder-item:last-child { border-bottom: none; }
.reorder-item.dragging {
  background: var(--orange-50);
  box-shadow: 0 4px 16px rgba(0,0,0,0.1);
  z-index: 10;
  border-radius: 10px;
}
.reorder-item .ro-handle {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  width: 28px;
  height: 28px;
  cursor: grab;
  color: var(--gray-300);
  font-size: 16px;
  flex-shrink: 0;
  touch-action: none;
}
.reorder-item .ro-handle:active { cursor: grabbing; color: var(--gray-500); }
.reorder-item .ro-name {
  flex: 1;
  font-size: 14px;
  font-weight: 600;
  color: var(--gray-700);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}
.reorder-item .ro-count {
  font-size: 11px;
  color: var(--gray-400);
  flex-shrink: 0;
}
.reorder-item .ro-arrows {
  display: flex;
  flex-direction: column;
  gap: 2px;
  flex-shrink: 0;
}
.reorder-item .ro-arrow-btn {
  width: 28px;
  height: 22px;
  border: none;
  border-radius: 6px;
  background: var(--gray-50);
  color: var(--gray-400);
  font-size: 12px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.15s;
  font-family: inherit;
}
.reorder-item .ro-arrow-btn:hover { background: var(--orange-50); color: var(--orange-500); }
.reorder-item .ro-arrow-btn:active { transform: scale(0.9); }
.reorder-item .ro-arrow-btn:disabled { opacity: 0.2; pointer-events: none; }
.reorder-done-btn {
  margin-top: 12px;
  width: 100%;
  padding: 14px;
  border: none;
  border-radius: 12px;
  background: linear-gradient(135deg, var(--orange-400), var(--orange-600));
  color: white;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  font-family: inherit;
  box-shadow: 0 4px 12px rgba(255,140,0,0.3);
}
.deck-mini-progress {
  display: flex;
  gap: 3px;
  margin-top: 4px;
}
.deck-mini-progress .mini-bar {
  height: 4px;
  border-radius: 2px;
  transition: width 0.3s;
}

/* Dashboard */
.donut-section {
  margin-bottom: 20px;
  background: white;
  border-radius: var(--radius);
  box-shadow: var(--shadow-sm);
  padding: 20px 16px;
}
.donut-wrap {
  display: flex;
  align-items: center;
  gap: 20px;
}
.donut-chart {
  position: relative;
  width: 130px;
  height: 130px;
  flex-shrink: 0;
}
.donut-chart svg {
  width: 130px;
  height: 130px;
  transform: rotate(-90deg);
}
.donut-chart .donut-center {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
}
.donut-center .donut-pct {
  font-size: 26px;
  font-weight: 900;
  font-family: 'DM Sans', sans-serif;
  color: var(--green-500);
  line-height: 1;
}
.donut-center .donut-pct-label {
  font-size: 10px;
  font-weight: 700;
  color: var(--gray-400);
  margin-top: 2px;
}
.donut-legend {
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 6px;
}
.donut-legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  padding: 4px 8px;
  border-radius: 8px;
  transition: background 0.15s;
}
.donut-legend-item:active {
  background: var(--gray-100);
}
.donut-legend-item.disabled {
  opacity: 0.3;
  pointer-events: none;
}
.donut-legend-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
}
.donut-legend-name {
  font-size: 12px;
  font-weight: 600;
  color: var(--gray-600);
  flex: 1;
}
.donut-legend-count {
  font-size: 14px;
  font-weight: 800;
  font-family: 'DM Sans', sans-serif;
  color: var(--gray-700);
}

/* Progress bar */
.progress-bar-container {
  background: white;
  border-radius: var(--radius-sm);
  padding: 16px;
  margin-bottom: 20px;
  box-shadow: var(--shadow-sm);
}
.progress-bar-container h4 {
  font-size: 13px;
  color: var(--gray-500);
  margin-bottom: 10px;
  font-weight: 500;
}
.progress-bar {
  height: 14px;
  border-radius: 7px;
  background: var(--gray-200);
  overflow: hidden;
  display: flex;
}
.progress-segment {
  height: 100%;
  transition: width 0.5s ease;
}
.progress-segment.mastered { background: var(--green-500); }
.progress-segment.fuzzy { background: var(--yellow-400); }
.progress-segment.weak { background: var(--red-400); }

/* Action buttons */
.action-section {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 20px;
}
.action-btn {
  background: white;
  border: none;
  border-radius: var(--radius);
  padding: 20px;
  display: flex;
  align-items: center;
  gap: 16px;
  cursor: pointer;
  box-shadow: var(--shadow-md);
  transition: all 0.25s;
  text-align: left;
}
.action-btn:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}
.action-btn:active { transform: scale(0.98); }
.action-btn .icon {
  width: 50px;
  height: 50px;
  border-radius: 14px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 24px;
  flex-shrink: 0;
}
.action-btn.study .icon { background: linear-gradient(135deg, var(--orange-400), var(--orange-600)); }
.action-btn.review .icon { background: linear-gradient(135deg, var(--blue-400), var(--blue-500)); }
.action-btn.list .icon { background: linear-gradient(135deg, var(--green-400), var(--green-600)); }
.action-btn.edit-words .icon { background: linear-gradient(135deg, var(--gray-400), var(--gray-600)); }
.action-btn.sync-export .icon { background: linear-gradient(135deg, #6366F1, #4F46E5); }
.action-btn.sync-import .icon { background: linear-gradient(135deg, #8B5CF6, #7C3AED); }
.action-btn .text h3 {
  font-size: 16px;
  font-weight: 700;
  color: var(--gray-800);
}
.action-btn .text p {
  font-size: 12px;
  color: var(--gray-400);
  margin-top: 2px;
}

.secondary-actions {
  display: flex;
  gap: 10px;
}
.secondary-btn {
  flex: 1;
  background: white;
  border: none;
  border-radius: var(--radius-sm);
  padding: 14px;
  font-family: inherit;
  font-size: 13px;
  font-weight: 600;
  color: var(--gray-600);
  cursor: pointer;
  box-shadow: var(--shadow-sm);
  transition: all 0.2s;
}
.secondary-btn:hover { background: var(--gray-100); }

/* Quiz screen */
.quiz-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
}
.quiz-back {
  background: white;
  border: none;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  font-size: 20px;
  cursor: pointer;
  box-shadow: var(--shadow-sm);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}
.quiz-back:hover { background: var(--gray-100); }
.quiz-progress-text {
  font-family: 'DM Sans', sans-serif;
  font-size: 14px;
  font-weight: 600;
  color: var(--gray-500);
}
.quiz-progress-bar {
  height: 6px;
  background: var(--gray-200);
  border-radius: 3px;
  margin-bottom: 30px;
  overflow: hidden;
}
.quiz-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--orange-400), var(--orange-500));
  border-radius: 3px;
  transition: width 0.4s ease;
}

#screen-quiz {
  height: calc(100vh - 40px - env(safe-area-inset-top) - env(safe-area-inset-bottom));
  display: none;
  flex-direction: column;
  overflow: hidden;
}
#screen-quiz.active {
  display: flex;
}
.quiz-card {
  background: white;
  border-radius: 24px;
  padding: 14px 16px 10px;
  text-align: center;
  box-shadow: var(--shadow-lg);
  margin-bottom: 4px;
  position: relative;
  overflow: hidden;
  flex: 1;
  min-height: 0;
  max-height: calc(100vh - 310px);
  display: flex;
  flex-direction: column;
  cursor: pointer;
  user-select: none;
  -webkit-user-select: none;
}
.quiz-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--orange-400), var(--orange-500));
}
.quiz-card .level-badge {
  display: inline-block;
  padding: 4px 12px;
  border-radius: 20px;
  font-size: 11px;
  font-weight: 700;
  margin-bottom: 12px;
  align-self: center;
}
.quiz-card .english-word {
  font-family: 'DM Sans', sans-serif;
  font-size: 32px;
  font-weight: 700;
  color: var(--gray-900);
  margin-bottom: 8px;
  letter-spacing: -0.5px;
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  word-break: break-word;
  overflow-wrap: break-word;
  line-height: 1.3;
  max-height: 35vh;
  overflow: hidden;
}

/* ===== Answer reveal area ===== */
.answer-reveal {
  margin-top: 16px;
  position: relative;
}
.answer-tap-hint {
  font-size: 14px;
  color: var(--gray-400);
  font-weight: 500;
  padding: 12px 0 4px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 6px;
}
.answer-tap-hint .tap-icon {
  font-size: 18px;
  animation: tapBounce 2s ease infinite;
}
@keyframes tapBounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-4px); }
}
.answer-text-area {
  display: none;
  font-size: 24px;
  color: var(--orange-500);
  font-weight: 700;
  padding: 8px 0 4px;
  animation: revealFade 0.3s ease;
}
.quiz-card.revealed .answer-tap-hint { display: none; }
.quiz-card.revealed .answer-text-area { display: block; }
.quiz-card.revealed { cursor: default; }

/* Bookmark button */
.bookmark-btn {
  width: 44px;
  height: 44px;
  border-radius: 50%;
  border: 2px solid var(--gray-200);
  background: white;
  font-size: 20px;
  cursor: pointer;
  z-index: 10;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0.6;
  flex-shrink: 0;
}
.bookmark-btn.active {
  background: var(--orange-500);
  border-color: var(--orange-500);
  opacity: 1;
}
.card-bookmark {
  position: absolute;
  bottom: 16px;
  right: 16px;
  width: 40px;
  height: 40px;
  font-size: 18px;
}

@keyframes revealFade {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

.choices {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.choice-btn {
  background: white;
  border: 2px solid var(--gray-200);
  border-radius: 14px;
  padding: 16px 20px;
  font-family: inherit;
  font-size: 16px;
  font-weight: 600;
  color: var(--gray-700);
  cursor: pointer;
  transition: all 0.2s;
  text-align: left;
  position: relative;
  overflow: hidden;
}
.choice-btn:hover:not(.disabled) {
  border-color: var(--orange-400);
  background: var(--orange-50);
}
.choice-btn.correct {
  border-color: var(--green-500);
  background: #F0FFF4;
  color: var(--green-600);
  animation: correctPulse 0.4s ease;
}
.choice-btn.wrong {
  border-color: var(--red-500);
  background: #FFF5F5;
  color: var(--red-500);
  animation: shake 0.4s ease;
}
.choice-btn.disabled { pointer-events: none; }
.choice-btn.show-correct {
  border-color: var(--green-500);
  background: #F0FFF4;
}

@keyframes correctPulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.02); }
  100% { transform: scale(1); }
}
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-6px); }
  75% { transform: translateX(6px); }
}

/* Know / Don't Know buttons */
.know-buttons-wrap {
  margin-top: 20px;
}
.know-buttons {
  display: flex;
  gap: 10px;
  align-items: center;
  justify-content: center;
}
.know-btn {
  flex: 1;
  padding: 18px;
  border-radius: 14px;
  font-family: inherit;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  border: 2px solid;
}
.know-btn.dont-know {
  background: #FFF5F5;
  border-color: var(--red-400);
  color: var(--red-500);
}
.know-btn.dont-know:hover { background: #FEE2E2; }
.know-btn.know {
  background: #F0FFF4;
  border-color: var(--green-400);
  color: var(--green-600);
}
.know-btn.know:hover { background: #DCFCE7; }

/* Quiz result */
.quiz-result {
  background: white;
  border-radius: 24px;
  padding: 40px 24px;
  text-align: center;
  box-shadow: var(--shadow-lg);
  position: relative;
}
.result-close-btn {
  position: absolute;
  top: 14px;
  left: 14px;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: none;
  background: var(--gray-100);
  color: var(--gray-500);
  font-size: 18px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
}
.result-close-btn:hover {
  background: var(--gray-200);
}
.result-close-btn:active {
  transform: scale(0.9);
}
.quiz-result .result-icon {
  font-size: 56px;
  margin-bottom: 16px;
}
.quiz-result h2 {
  font-size: 24px;
  font-weight: 900;
  color: var(--gray-800);
  margin-bottom: 8px;
}
.quiz-result p {
  font-size: 14px;
  color: var(--gray-500);
  margin-bottom: 24px;
  line-height: 1.6;
}
.result-stats {
  display: flex;
  justify-content: center;
  gap: 24px;
  margin-bottom: 28px;
}
.result-stat {
  text-align: center;
}
.result-stat .num {
  font-family: 'DM Sans', sans-serif;
  font-size: 28px;
  font-weight: 700;
}
.result-stat .label {
  font-size: 12px;
  color: var(--gray-400);
  margin-top: 2px;
}
.result-btn {
  background: var(--orange-500);
  color: white;
  border: none;
  padding: 16px 40px;
  border-radius: 50px;
  font-family: inherit;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(255,140,0,0.3);
  transition: all 0.2s;
}
.result-btn:hover {
  background: var(--orange-600);
  transform: translateY(-1px);
}
.result-btn.review-btn {
  background: white;
  color: var(--orange-500);
  border: 2px solid var(--orange-500);
  box-shadow: none;
  margin-bottom: 10px;
}
.result-btn.review-btn:hover {
  background: var(--orange-50);
}
.result-btn.next-quiz-btn {
  background: var(--orange-500);
  color: white;
  box-shadow: 0 4px 15px rgba(255,140,0,0.3);
  display: block;
  width: 100%;
  margin-bottom: 10px;
}
.missed-section {
  text-align: left;
  margin: 20px 0;
  width: 100%;
}
.missed-section h4 {
  font-size: 14px;
  font-weight: 700;
  color: var(--red-500);
  margin-bottom: 10px;
  text-align: center;
}
.missed-list {
  max-height: 240px;
  overflow-y: auto;
  border: 1px solid var(--gray-200);
  border-radius: var(--radius-sm);
  -webkit-overflow-scrolling: touch;
}
.missed-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 10px 14px;
  border-bottom: 1px solid var(--gray-100);
  font-size: 14px;
}
.missed-item:last-child { border-bottom: none; }
.missed-eng {
  font-weight: 600;
  color: var(--gray-800);
}
.missed-jpn {
  color: var(--red-400);
  font-size: 13px;
}

/* Level change summary */
.level-change-section {
  width: 100%;
  margin: 20px 0;
  text-align: left;
}
.level-change-section h4 {
  font-size: 14px;
  font-weight: 700;
  color: var(--gray-600);
  margin-bottom: 12px;
  text-align: center;
}
.lc-row {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
  animation: lcRowSlide 0.4s ease both;
}
.lc-label {
  font-size: 13px;
  font-weight: 700;
  color: var(--gray-600);
  width: 60px;
  text-align: right;
  flex-shrink: 0;
}
.lc-bar-wrap {
  flex: 1;
  height: 28px;
  background: var(--gray-100);
  border-radius: 8px;
  overflow: hidden;
  position: relative;
}
.lc-bar {
  height: 100%;
  border-radius: 8px;
  display: flex;
  align-items: center;
  padding-left: 10px;
  font-size: 13px;
  font-weight: 700;
  color: white;
  min-width: 28px;
}
.lc-count {
  font-size: 13px;
  font-weight: 700;
}
.lc-diff {
  font-size: 16px;
  font-weight: 900;
  width: 40px;
  flex-shrink: 0;
  opacity: 0;
}
.lc-diff.plus { color: var(--green-500); }
.lc-diff.minus { color: var(--red-500); }
@keyframes diffPop {
  0% { opacity: 0; transform: scale(0.5) translateY(8px); }
  60% { opacity: 1; transform: scale(1.2) translateY(-2px); }
  100% { opacity: 1; transform: scale(1) translateY(0); }
}
@keyframes lcRowSlide {
  from { opacity: 0; transform: translateX(-20px); }
  to { opacity: 1; transform: translateX(0); }
}

/* Search bar */
.search-bar {
  display: flex;
  align-items: center;
  background: white;
  border-radius: 12px;
  padding: 10px 14px;
  margin-bottom: 12px;
  box-shadow: var(--shadow-sm);
  border: 2px solid var(--gray-200);
  transition: border-color 0.2s;
}
.search-bar:focus-within { border-color: var(--orange-400); }
.search-bar .search-icon { font-size: 16px; margin-right: 8px; }
.search-bar input {
  flex: 1;
  border: none;
  outline: none;
  font-family: inherit;
  font-size: 15px;
  background: transparent;
  color: var(--gray-800);
}
.search-bar input::placeholder { color: var(--gray-300); }
.search-clear {
  display: none;
  border: none;
  background: var(--gray-200);
  color: var(--gray-500);
  width: 24px;
  height: 24px;
  border-radius: 50%;
  font-size: 12px;
  cursor: pointer;
  align-items: center;
  justify-content: center;
}
.search-clear.show { display: flex; }

/* Deck tabs in word list */
.deck-tabs {
  display: flex;
  gap: 6px;
  margin-bottom: 12px;
  overflow-x: auto;
  padding-bottom: 4px;
  -webkit-overflow-scrolling: touch;
}
.deck-tabs::-webkit-scrollbar { display: none; }
.deck-tab {
  padding: 8px 16px;
  border-radius: 20px;
  border: 2px solid var(--gray-200);
  background: white;
  font-family: inherit;
  font-size: 13px;
  font-weight: 700;
  color: var(--gray-500);
  cursor: pointer;
  transition: all 0.2s;
  white-space: nowrap;
  flex-shrink: 0;
}
.deck-tab:hover { border-color: var(--orange-300); }
.deck-tab.active {
  background: var(--orange-500);
  border-color: var(--orange-500);
  color: white;
}

/* Word list */
.word-list-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 16px;
}
.word-list-header h2 {
  font-size: 20px;
  font-weight: 900;
  flex: 1;
}
.filter-tabs {
  display: flex;
  gap: 6px;
  margin-bottom: 16px;
  flex-wrap: wrap;
}
.filter-tab {
  padding: 8px 14px;
  border-radius: 20px;
  border: none;
  font-family: inherit;
  font-size: 12px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.2s;
  background: white;
  color: var(--gray-500);
  box-shadow: var(--shadow-sm);
}
.filter-tab.active { color: white; }
.filter-tab.all.active { background: var(--gray-700); }
.filter-tab.unlearned.active { background: var(--gray-400); }
.filter-tab.weak.active { background: var(--red-500); }
.filter-tab.fuzzy.active { background: var(--yellow-500); }
.filter-tab.bookmarked.active { background: var(--orange-500); }
.filter-tab.mastered.active { background: var(--green-500); }

.word-items {
  display: flex;
  flex-direction: column;
  gap: 8px;
  max-height: 60vh;
  overflow-y: auto;
  padding-right: 4px;
}
.word-items::-webkit-scrollbar { width: 4px; }
.word-items::-webkit-scrollbar-thumb { background: var(--gray-300); border-radius: 2px; }

.word-item {
  background: white;
  border-radius: var(--radius-sm);
  padding: 12px 14px;
  display: flex;
  align-items: flex-start;
  gap: 10px;
  box-shadow: var(--shadow-sm);
  transition: all 0.2s;
  cursor: pointer;
  user-select: none;
  -webkit-user-select: none;
}
.word-item:hover { transform: translateX(4px); }
.word-item .level-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  flex-shrink: 0;
  margin-top: 5px;
}
.word-item .level-dot.unlearned { background: var(--gray-300); }
.word-item .level-dot.weak { background: var(--red-500); }
.word-item .level-dot.fuzzy { background: var(--yellow-500); }
.word-item .level-dot.bookmarked { background: var(--orange-500); }
.word-item .level-dot.mastered { background: var(--green-500); }
.word-item .eng {
  font-family: 'DM Sans', sans-serif;
  font-size: 14px;
  font-weight: 600;
  color: var(--gray-800);
  flex: 1;
  min-width: 0;
  word-break: break-word;
  line-height: 1.4;
  transition: all 0.2s;
}
.word-item .eng.hidden-question {
  color: transparent;
  background: var(--gray-200);
  border-radius: 4px;
  min-height: 20px;
}
.word-item .jpn-container {
  position: relative;
  flex-shrink: 0;
  max-width: 45%;
}
.word-item .jpn {
  font-size: 13px;
  color: var(--gray-500);
  transition: all 0.2s;
  word-break: break-word;
}
.word-item .jpn.hidden-answer {
  color: transparent;
  background: var(--gray-200);
  border-radius: 4px;
  padding: 2px 8px;
  font-size: 12px;
  position: relative;
  min-width: 60px;
  text-align: center;
}
.word-item .jpn.hidden-answer::after {
  content: '';
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--gray-400);
  font-size: 11px;
  font-weight: 600;
}

/* Quiz mode selector */
.answer-toggle-btn {
  background: var(--gray-100);
  border: 1.5px solid var(--gray-200);
  border-radius: 20px;
  padding: 6px 14px;
  font-family: inherit;
  font-size: 12px;
  font-weight: 700;
  color: var(--gray-500);
  cursor: pointer;
  transition: all 0.2s;
}
.answer-toggle-btn.hiding {
  background: var(--orange-500);
  color: white;
  border-color: var(--orange-500);
}
#screen-quiz-setup {
  display: none;
  min-height: calc(100vh - 140px);
  flex-direction: column;
  justify-content: center;
}
#screen-quiz-setup.active {
  display: flex;
}
#screen-level-select {
  display: none;
  min-height: calc(100vh - 140px);
  flex-direction: column;
  justify-content: center;
}
#screen-level-select.active {
  display: flex;
}
.mode-selector {
  background: white;
  border-radius: var(--radius);
  padding: 20px;
  box-shadow: var(--shadow-lg);
  margin-bottom: 20px;
}
.mode-selector h3 {
  font-size: 16px;
  font-weight: 700;
  margin-bottom: 16px;
  text-align: center;
}
.setup-section-label {
  font-size: 13px;
  font-weight: 700;
  color: var(--gray-500);
  margin-bottom: 8px;
  margin-top: 16px;
}
.setup-word-list {
  max-height: 40vh;
  overflow-y: auto;
  border: 1px solid var(--gray-200);
  border-radius: var(--radius-sm);
  margin-bottom: 8px;
  -webkit-overflow-scrolling: touch;
}
.setup-word-item {
  display: flex;
  align-items: center;
  padding: 10px 14px;
  border-bottom: 1px solid var(--gray-100);
  font-size: 14px;
}
.setup-word-item:last-child { border-bottom: none; }
.setup-word-item .sw-eng {
  flex: 1;
  font-weight: 600;
  color: var(--gray-800);
  min-width: 0;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}
.setup-word-item .sw-jpn {
  color: var(--gray-400);
  font-size: 13px;
  flex-shrink: 0;
  max-width: 45%;
  text-align: right;
}
.mode-toggle {
  display: flex;
  gap: 6px;
  border-radius: 12px;
  overflow: visible;
  margin-bottom: 8px;
}
.mode-toggle-btn {
  flex: 1;
  padding: 14px;
  border: 2px solid var(--gray-200);
  border-radius: 12px;
  background: white;
  font-family: inherit;
  font-size: 15px;
  font-weight: 700;
  color: var(--gray-400);
  cursor: pointer;
  transition: all 0.2s;
}
.mode-toggle-btn.active {
  background: white;
  color: var(--orange-500);
  border-color: var(--orange-400);
  box-shadow: 0 0 0 1px var(--orange-200);
}
.drill-desc {
  font-size: 12px;
  color: var(--orange-500);
  text-align: center;
  margin-bottom: 8px;
  font-weight: 600;
}

/* Level select screen */
.level-select-grid {
  display: flex;
  flex-direction: column;
  gap: 0;
}
.level-select-card {
  background: white;
  border-radius: var(--radius-sm);
  padding: 14px 10px;
  text-align: center;
  box-shadow: var(--shadow-sm);
  cursor: pointer;
  transition: all 0.2s;
  border: 2px solid transparent;
  min-width: 72px;
  flex-shrink: 0;
}
.level-select-card:hover { transform: translateY(-2px); }
.level-select-card:active { transform: scale(0.97); }
.level-select-card.disabled {
  opacity: 0.35;
  cursor: default;
  pointer-events: none;
}
.level-select-card.disabled:hover { transform: none; }
.level-select-card .ls-icon { font-size: 20px; margin-bottom: 4px; }
.level-select-card .ls-label {
  font-size: 11px;
  font-weight: 700;
  margin-bottom: 2px;
}
.level-select-card .ls-count {
  font-size: 18px;
  font-weight: 900;
  font-family: 'DM Sans', sans-serif;
}
.level-select-card.all .ls-label, .level-select-card.all .ls-count { color: var(--gray-700); }
.level-select-card.unlearned .ls-label, .level-select-card.unlearned .ls-count { color: var(--gray-600); }
.level-select-card.bookmarked .ls-label, .level-select-card.bookmarked .ls-count { color: var(--orange-500); }
.level-select-card.weak .ls-label, .level-select-card.weak .ls-count { color: var(--red-500); }
.level-select-card.fuzzy .ls-label, .level-select-card.fuzzy .ls-count { color: var(--yellow-500); }
.level-select-card.mastered .ls-label, .level-select-card.mastered .ls-count { color: var(--green-500); }
.level-select-card.locked {
  opacity: 0.5;
  cursor: pointer;
  position: relative;
  background: var(--gray-50);
  border: 2px dashed var(--gray-300);
}
.level-select-row {
  display: flex;
  gap: 8px;
  overflow-x: auto;
  -webkit-overflow-scrolling: touch;
  padding-bottom: 4px;
  scrollbar-width: none;
}
.level-select-row::-webkit-scrollbar { display: none; }
.level-praise-banner {
  background: linear-gradient(135deg, #FEF3C7, #FDE68A);
  border-radius: var(--radius);
  padding: 16px;
  text-align: center;
  margin-bottom: 14px;
  box-shadow: 0 2px 12px rgba(234, 179, 8, 0.2);
}
.level-praise-banner .praise-emoji {
  font-size: 28px;
  margin-bottom: 6px;
}
.level-praise-banner .praise-title {
  font-size: 18px;
  font-weight: 900;
  color: var(--orange-600);
  margin-bottom: 4px;
}
.level-praise-banner .praise-sub {
  font-size: 12px;
  color: var(--gray-600);
  line-height: 1.5;
}
.mode-options {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.mode-option {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 14px 16px;
  border: 2px solid var(--gray-200);
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.2s;
  background: white;
}
.mode-option:hover { border-color: var(--orange-300); }
.mode-option.selected { border-color: var(--orange-500); background: var(--orange-50); }
.mode-option .mode-icon { font-size: 24px; }
.mode-option .mode-text h4 {
  font-size: 14px;
  font-weight: 700;
}
.mode-option .mode-text p {
  font-size: 11px;
  color: var(--gray-400);
  margin-top: 1px;
}

.count-selector {
  margin-top: 16px;
  text-align: center;
}
.count-selector label {
  font-size: 13px;
  color: var(--gray-500);
  font-weight: 500;
}
.count-selector select {
  margin-left: 8px;
  padding: 6px 12px;
  border: 2px solid var(--gray-200);
  border-radius: 8px;
  font-family: inherit;
  font-size: 14px;
  font-weight: 600;
  color: var(--gray-700);
  cursor: pointer;
}
.start-quiz-btn {
  width: 100%;
  margin-top: 16px;
  background: var(--orange-500);
  color: white;
  border: none;
  padding: 16px;
  border-radius: 50px;
  font-family: inherit;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  box-shadow: 0 4px 15px rgba(255,140,0,0.3);
  transition: all 0.2s;
}
.start-quiz-btn:hover { background: var(--orange-600); }
.start-quiz-btn:disabled {
  background: var(--gray-300);
  box-shadow: none;
  cursor: not-allowed;
}

/* Toast */
.toast {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  background: var(--gray-800);
  color: white;
  padding: 14px 24px;
  border-radius: 50px;
  font-size: 14px;
  font-weight: 600;
  z-index: 1000;
  box-shadow: var(--shadow-xl);
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
  transition: opacity 0.3s ease, visibility 0.3s ease;
}
.toast.show {
  opacity: 1;
  visibility: visible;
}

/* Level badge colors */
.badge-unlearned { background: var(--gray-200); color: var(--gray-500); }
.badge-weak { background: #FEE2E2; color: var(--red-500); }
.badge-fuzzy { background: #FEF9C3; color: var(--yellow-500); }
.badge-bookmarked { background: var(--orange-100); color: var(--orange-500); }
.badge-mastered { background: #DCFCE7; color: var(--green-600); }

/* Confirm modal */
.confirm-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.5);
  z-index: 2000;
  display: none;
  align-items: center;
  justify-content: center;
  padding: 24px;
  animation: fadeInOverlay 0.2s ease;
}
.confirm-overlay.show { display: flex; }
@keyframes fadeInOverlay { from { opacity: 0; } to { opacity: 1; } }
.confirm-modal {
  background: white;
  border-radius: 20px;
  padding: 32px 24px 24px;
  text-align: center;
  max-width: 340px;
  width: 100%;
  box-shadow: var(--shadow-xl);
  animation: modalPop 0.25s ease;
}
@keyframes modalPop {
  from { opacity: 0; transform: scale(0.9); }
  to { opacity: 1; transform: scale(1); }
}
.confirm-modal .confirm-icon {
  font-size: 40px;
  margin-bottom: 12px;
}
.confirm-modal h3 {
  font-size: 18px;
  font-weight: 900;
  color: var(--gray-800);
  margin-bottom: 8px;
}
.confirm-modal p {
  font-size: 13px;
  color: var(--gray-500);
  line-height: 1.6;
  margin-bottom: 24px;
}
.confirm-buttons {
  display: flex;
  gap: 10px;
}
.confirm-cancel {
  flex: 1;
  padding: 14px;
  border-radius: 12px;
  border: 2px solid var(--gray-200);
  background: white;
  font-family: inherit;
  font-size: 15px;
  font-weight: 700;
  color: var(--gray-600);
  cursor: pointer;
  transition: all 0.2s;
}
.confirm-cancel:hover { background: var(--gray-100); }
.confirm-danger {
  flex: 1;
  padding: 14px;
  border-radius: 12px;
  border: none;
  background: var(--red-500);
  font-family: inherit;
  font-size: 15px;
  font-weight: 700;
  color: white;
  cursor: pointer;
  transition: all 0.2s;
  box-shadow: 0 4px 12px rgba(239,68,68,0.3);
}
.confirm-danger:hover { background: #DC2626; }
.rename-input {
  width: 100%;
  padding: 12px 14px;
  border: 2px solid var(--gray-200);
  border-radius: 12px;
  font-family: inherit;
  font-size: 15px;
  margin-bottom: 16px;
  outline: none;
  transition: border-color 0.2s;
  box-sizing: border-box;
}
.rename-input:focus { border-color: var(--orange-400); }
input[type="search"].rename-input::-webkit-search-decoration,
input[type="search"].rename-input::-webkit-search-cancel-button { -webkit-appearance: none; display: none; }
.rename-editable {
  min-height: 20px;
  line-height: 1.4;
  cursor: text;
  white-space: pre-wrap;
  word-break: break-word;
  -webkit-user-select: text;
  user-select: text;
}
.rename-editable:empty::before {
  content: attr(data-placeholder);
  color: var(--gray-300);
  pointer-events: none;
}
.rename-editable:focus {
  outline: none;
  border-color: var(--orange-400);
}
.rename-editable br { display: none; }
.rename-editable * { display: inline; }

/* Word editor */
#screen-word-editor {
  display: none;
  flex-direction: column;
  height: calc(100vh - 40px - env(safe-area-inset-top) - env(safe-area-inset-bottom));
  overflow: hidden;
}
#screen-word-editor.active {
  display: flex;
}
.editor-header {
  padding: 0;
  margin-bottom: 12px;
  flex-shrink: 0;
  background: var(--bg);
  z-index: 5;
}
.editor-header-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
}
.editor-title {
  font-size: 22px;
  font-weight: 900;
  color: var(--gray-800);
}
.editor-word-list {
  flex: 1;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
  display: flex;
  flex-direction: column;
  gap: 6px;
  padding-bottom: 40px;
}
.editor-add-btn {
  background: var(--orange-500);
  color: white;
  border: none;
  border-radius: 8px;
  padding: 6px 14px;
  font-family: inherit;
  font-size: 14px;
  font-weight: 700;
  cursor: pointer;
}
.editor-word-item {
  position: relative;
  overflow: hidden;
  border-radius: var(--radius-sm);
  box-shadow: var(--shadow-sm);
  margin-bottom: 2px;
  flex-shrink: 0;
}
.editor-word-item .ew-inner {
  background: white;
  padding: 12px 14px;
  display: flex;
  align-items: center;
  gap: 10px;
  position: relative;
  z-index: 1;
  transition: transform 0.25s ease;
  cursor: pointer;
}
.editor-word-item .ew-content {
  flex: 1;
  min-width: 0;
}
.editor-word-item .ew-eng {
  font-size: 14px;
  font-weight: 600;
  color: var(--gray-800);
  word-break: break-word;
  line-height: 1.4;
}
.editor-word-item .ew-jpn {
  font-size: 12px;
  color: var(--gray-400);
  margin-top: 2px;
  word-break: break-word;
}
.edit-word-modal .rename-input { margin-bottom: 10px; }

/* Reset button */
.reset-area {
  margin-top: 20px;
  text-align: center;
}
.reset-btn {
  background: none;
  border: none;
  color: var(--gray-400);
  font-family: inherit;
  font-size: 12px;
  cursor: pointer;
  padding: 8px 16px;
  transition: color 0.2s;
}
.reset-btn:hover { color: var(--red-500); }
</style>
</head>
<body>
<div class="app">

  <!-- Screen: Import -->
  <div id="screen-import" class="screen active">
    <div class="header">
      <button class="help-toggle" onclick="showHelp()"></button>
    </div>
    <div class="import-area" id="dropZone">
      <div class="import-icon"></div>
      <h3>CSV</h3>
      <p><br><small> CSV</small></p>
      <input type="file" id="fileInput" accept=".csv,.txt">
    </div>
    <div class="format-hint">
      <h4 style="font-size:13px;font-weight:700;margin-bottom:10px;color:var(--gray-600);"> CSV:, :</h4>
      <div class="format-tabs">
        <button class="format-tab active" onclick="switchFormatTab(0, this)"></button>
        <button class="format-tab" onclick="switchFormatTab(1, this)"></button>
        <button class="format-tab" onclick="switchFormatTab(2, this)"></button>
        <button class="format-tab" onclick="switchFormatTab(3, this)">SPI</button>
        <button class="format-tab" onclick="switchFormatTab(4, this)"></button>
        <button class="format-tab" onclick="switchFormatTab(5, this)"></button>
      </div>
      <code id="formatExample">
        abandon,<br>
        accomplish,<br>
        adequate,
      </code>
    </div>
    <div style="text-align:center;margin-top:20px;">
      <button class="demo-btn" onclick="loadDemo()"></button>
    </div>

    <div style="margin-top:24px;padding:16px;background:white;border-radius:var(--radius);box-shadow:var(--shadow-sm);">
      <div style="text-align:center;margin-bottom:8px;">
        <span style="font-size:24px;"></span>
      </div>
      <h4 style="font-size:14px;font-weight:700;color:var(--gray-700);text-align:center;margin-bottom:4px;"></h4>
      <p style="font-size:12px;color:var(--gray-400);text-align:center;margin-bottom:12px;line-height:1.5;">JSON<br></p>
      <button class="secondary-btn" style="width:100%;" onclick="document.getElementById('importJsonInitial').click()"> JSON</button>
      <input type="file" id="importJsonInitial" accept=".json" style="position:absolute;left:-9999px;width:1px;height:1px;opacity:0;" onchange="importAllData(event)">
    </div>
  </div>

  <!-- Screen: Dashboard -->
  <div id="screen-dashboard" class="screen">
    <!-- Deck selector - horizontal carousel -->
    <div class="deck-carousel-section">
      <div class="deck-carousel-header">
        <h3> </h3>
        <span class="deck-carousel-count" id="deckPickerCount">1/1</span>
      </div>
      <div class="deck-carousel-vp" id="carouselViewport">
        <div class="deck-carousel-track" id="carouselTrack"></div>
      </div>
      <div style="margin-top:10px;">
        <button class="secondary-btn" style="width:100%;" onclick="document.getElementById('fileInputAdd').click()"> CSV</button>
        <input type="file" id="fileInputAdd" accept=".csv,.txt" style="position:absolute;left:-9999px;width:1px;height:1px;opacity:0;" onchange="handleFileAdd(this.files[0])">
      </div>
    </div>

    <div class="donut-section" id="donutSection">
      <div class="donut-wrap">
        <div class="donut-chart">
          <svg viewBox="0 0 100 100"><g id="donutRings"></g></svg>
          <div class="donut-center">
            <div class="donut-pct" id="donutPct">0%</div>
            <div class="donut-pct-label"></div>
          </div>
        </div>
        <div class="donut-legend" id="donutLegend"></div>
      </div>
    </div>

    <div class="action-section">
      <button class="action-btn study" onclick="showLevelSelect()">
        <div class="icon"></div>
        <div class="text">
          <h3></h3>
          <p></p>
        </div>
      </button>
    </div>

    <div class="action-section">
      <button class="action-btn edit-words" onclick="showWordEditor()">
        <div class="icon"></div>
        <div class="text">
          <h3></h3>
          <p></p>
        </div>
      </button>
      <button class="action-btn list" onclick="showWordList()">
        <div class="icon"></div>
        <div class="text">
          <h3></h3>
          <p></p>
        </div>
      </button>
    </div>

    <div class="action-section">
      <button class="action-btn sync-export" onclick="exportAllData()">
        <div class="icon"></div>
        <div class="text">
          <h3></h3>
          <p>JSON</p>
        </div>
      </button>
      <button class="action-btn sync-import" onclick="document.getElementById('importJsonInput').click()">
        <div class="icon"></div>
        <div class="text">
          <h3></h3>
          <p>JSON</p>
        </div>
      </button>
      <input type="file" id="importJsonInput" accept=".json" style="position:absolute;left:-9999px;width:1px;height:1px;opacity:0;" onchange="importAllData(event)">
    </div>

    <div class="reset-area">
      <button class="reset-btn" onclick="confirmAction('', '', doResetCurrentDeck)"> </button>
      <button class="reset-btn" onclick="confirmAction('', '', doResetAll)"> </button>
    </div>
  </div>

  <!-- Screen: Level Select -->
  <div id="screen-level-select" class="screen">
    <div class="quiz-header">
      <button class="quiz-back" onclick="showScreen('dashboard')"></button>
      <span class="quiz-progress-text"></span>
      <div style="width:40px"></div>
    </div>
    <div class="level-select-grid" id="levelSelectGrid"></div>
  </div>

  <!-- Screen: Quiz Setup -->
  <div id="screen-quiz-setup" class="screen">
    <div class="quiz-header">
      <button class="quiz-back" id="setupBackBtn" onclick="showScreen('dashboard')"></button>
      <span class="quiz-progress-text" id="setupTitle"></span>
      <div style="width:40px"></div>
    </div>
    <div class="mode-selector">
      <h4 class="setup-section-label"></h4>
      <div class="mode-toggle" id="modeToggle">
        <button class="mode-toggle-btn active" onclick="selectMode('normal', this)"></button>
        <button class="mode-toggle-btn" onclick="selectMode('drill', this)"></button>
      </div>
      <div class="drill-desc" id="drillDesc" style="display:none;"></div>
      <h4 class="setup-section-label"></h4>
      <div class="mode-toggle" id="reverseToggle">
        <button class="mode-toggle-btn active" onclick="selectReverse(false, this)"></button>
        <button class="mode-toggle-btn" onclick="selectReverse(true, this)"></button>
      </div>
      <h4 class="setup-section-label"></h4>
      <div class="mode-toggle" id="ttsToggle">
        <button class="mode-toggle-btn" onclick="selectTTS('question', this)"></button>
        <button class="mode-toggle-btn active" onclick="selectTTS('answer', this)"></button>
        <button class="mode-toggle-btn" onclick="selectTTS('both', this)"></button>
        <button class="mode-toggle-btn" onclick="selectTTS('none', this)"></button>
      </div>
      <h4 class="setup-section-label"></h4>
      <div class="mode-toggle" id="orderToggle">
        <button class="mode-toggle-btn active" onclick="selectOrder('asc', this)"></button>
        <button class="mode-toggle-btn" onclick="selectOrder('desc', this)"></button>
        <button class="mode-toggle-btn" onclick="selectOrder('random', this)"></button>
      </div>
      <div class="count-selector">
        <label></label>
        <select id="quizCount">
          <option value="10">10</option>
          <option value="20">20</option>
          <option value="30">30</option>
          <option value="40">40</option>
          <option value="50">50</option>
          <option value="60">60</option>
          <option value="70">70</option>
          <option value="80">80</option>
          <option value="90">90</option>
          <option value="100">100</option>
          <option value="110">110</option>
          <option value="120">120</option>
          <option value="130">130</option>
          <option value="140">140</option>
          <option value="150">150</option>
          <option value="160">160</option>
          <option value="170">170</option>
          <option value="180">180</option>
          <option value="190">190</option>
          <option value="200">200</option>
          <option value="all"></option>
        </select>
      </div>
      <button class="start-quiz-btn" id="startQuizBtn" onclick="startQuiz()"></button>
    </div>
  </div>

  <!-- Screen: Quiz -->
  <div id="screen-quiz" class="screen">
    <div class="quiz-header">
      <button class="quiz-back" onclick="confirmQuit()"></button>
      <span class="quiz-progress-text" id="quizProgressText">1 / 10</span>
      <div style="width:40px"></div>
    </div>
    <div class="quiz-progress-bar">
      <div class="quiz-progress-fill" id="quizProgressFill"></div>
    </div>
    <div class="quiz-card" id="quizCard" onclick="revealAnswer()">
      <div class="level-badge" id="quizBadge"></div>
      <div class="english-word" id="quizWord"></div>
      <div class="answer-reveal" id="answerReveal"></div>
      <button class="bookmark-btn card-bookmark" id="bookmarkBtn" onclick="event.stopPropagation();toggleBookmark()"></button>
    </div>
    <div id="quizBody"></div>
  </div>

  <!-- Screen: Result -->
  <div id="screen-result" class="screen">
    <div class="quiz-result" id="resultContent"></div>
  </div>

  <!-- Screen: Word List -->
  <div id="screen-wordlist" class="screen">
    <div class="word-list-header">
      <button class="quiz-back" onclick="showScreen('dashboard')"></button>
      <h2></h2>
    </div>
    <div class="search-bar">
      <span class="search-icon"></span>
      <input type="text" id="wordSearchInput" placeholder="..." oninput="onWordSearch()">
      <button class="search-clear" id="searchClear" onclick="clearWordSearch()"></button>
    </div>
    <div class="deck-tabs" id="deckTabs"></div>
    <div class="filter-tabs" id="filterTabs"></div>
    <div style="display:flex;justify-content:flex-end;gap:8px;margin-bottom:8px;">
      <button class="answer-toggle-btn" id="questionToggleBtn" onclick="toggleAllQuestions()"></button>
      <button class="answer-toggle-btn" id="answerToggleBtn" onclick="toggleAllAnswers()"></button>
    </div>
    <div class="word-items" id="wordItems"></div>
  </div>

  <!-- Screen: Word Editor -->
  <div id="screen-word-editor" class="screen">
    <div class="editor-header" id="editorHeader">
      <div class="editor-header-top">
        <button class="quiz-back" onclick="showScreen('dashboard'); renderDeckList(); updateDashboard();"></button>
        <button class="editor-add-btn" onclick="addWordDirect()"></button>
      </div>
      <h2 class="editor-title"></h2>
      <div class="search-bar" style="margin-top:10px;">
        <span class="search-icon"></span>
        <input type="text" id="editorSearchInput" placeholder="..." oninput="onEditorSearch()" autocomplete="off">
        <button class="search-clear" id="editorSearchClear" onclick="clearEditorSearch()"></button>
      </div>
    </div>
    <div class="editor-word-list" id="editorWordList"></div>
  </div>

</div>

  <!-- Modal: Edit Word -->
  <div class="confirm-overlay" id="editWordOverlay" onclick="closeEditWord()">
    <div class="confirm-modal edit-word-modal" onclick="event.stopPropagation()">
      <div class="confirm-icon"></div>
      <h3 id="editWordTitle"></h3>
      <input type="text" id="editWordEng" class="rename-input" placeholder="" autocomplete="off" autocorrect="off" data-form-type="other">
      <input type="text" id="editWordJpn" class="rename-input" placeholder="" autocomplete="off" autocorrect="off" data-form-type="other">
      <div id="insertPositionRow" style="display:none;margin-bottom:14px;">
        <label style="font-size:12px;font-weight:600;color:var(--gray-500);display:block;margin-bottom:6px;"></label>
        <select id="insertPosition" class="rename-input" style="margin-bottom:0;padding:10px 12px;font-size:14px;"></select>
      </div>
      <div class="confirm-buttons">
        <button class="confirm-cancel" onclick="closeEditWord()"></button>
        <button class="confirm-danger" style="background:var(--orange-500);box-shadow:0 4px 12px rgba(255,140,0,0.3);" onclick="saveWord()"></button>
      </div>
      <div id="editWordDeleteRow" style="display:none;margin-top:12px;text-align:center;">
        <button onclick="deleteEditingWord()" style="border:none;background:none;color:var(--red-500);font-size:13px;font-weight:600;cursor:pointer;padding:8px 16px;font-family:inherit;"> </button>
      </div>
    </div>
  </div>

<!-- Help overlay -->
<div class="confirm-overlay" id="helpOverlay" onclick="closeHelp()">
  <div class="confirm-modal help-modal" onclick="event.stopPropagation()">
    <div class="help-scroll">
      <h2 style="text-align:center;margin-bottom:16px;"> </h2>

      <div class="help-section">
        <h3> AICSV</h3>
        <p>ChatGPTGeminiClaude</p>
        <div class="help-prompt">TOEIC100,CSV</div>
        <p></p>
        <div class="help-prompt">50,CSV</div>
        <div class="help-prompt">IT30,CSV</div>
      </div>

      <div class="help-section">
        <h3> CSV</h3>
        <p><strong></strong></p>
        <p>AI     <code>.txt</code>  <code>.csv</code> </p>
        <p><strong>PC</strong></p>
        <p>   <code>.csv</code> </p>
      </div>

      <div class="help-section">
        <h3> </h3>
        <p> CSV  </p>
      </div>

      <div class="help-section">
        <h3> CSV</h3>
        <p>1,</p>
        <code style="display:block;margin:8px 0;">apple,<br>,1185<br>TCP/IP,</code>
      </div>

      <div class="help-section">
        <h3> </h3>
        <p><strong></strong> </p>
        <p><strong></strong> /</p>
        <p><strong></strong> </p>
        <p><strong> </strong> </p>
      </div>

      <button class="result-btn" style="width:100%;margin-top:16px;" onclick="closeHelp()"></button>
    </div>
  </div>
</div>

<!-- Celebration overlay -->
<canvas id="confettiCanvas" style="position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:9999;"></canvas>
<div class="confirm-overlay" id="celebrationOverlay">
  <div class="confirm-modal celebration-modal" onclick="event.stopPropagation()">
    <div style="font-size:60px;margin-bottom:12px;"></div>
    <h2 style="color:var(--orange-500);margin-bottom:8px;"></h2>
    <p style="font-size:15px;color:var(--gray-600);margin-bottom:4px;"><strong id="celebrationDeck"></strong></p>
    <p style="font-size:28px;font-weight:900;color:var(--green-500);margin-bottom:8px;"><span id="celebrationCount">0</span> </p>
    <p style="font-size:14px;color:var(--gray-500);margin-bottom:20px;line-height:1.6;"><br></p>
    <button class="result-btn" onclick="closeCelebration()"></button>
  </div>
</div>

<!-- Demo picker overlay -->
<div class="confirm-overlay" id="demoPickerOverlay" onclick="closeDemoPicker()">
  <div class="confirm-modal demo-picker-modal" onclick="event.stopPropagation()">
    <h3 style="text-align:center;margin-bottom:16px;"> </h3>
    <div class="demo-list">
      <button class="demo-item" onclick="loadDemoData('korean')">  <span>99</span></button>
      <button class="demo-item" onclick="loadDemoData('education_law')"> <span>10</span></button>
      <button class="demo-item" onclick="loadDemoData('curriculum')"> <span>10</span></button>
      <button class="demo-item" onclick="loadDemoData('student_guidance')"> <span>10</span></button>
      <button class="demo-item" onclick="loadDemoData('pe_exam')">  <span>10</span></button>
      <button class="demo-item" onclick="loadDemoData('kochi_exam')">  <span>10</span></button>
    </div>
    <button class="confirm-cancel" style="width:100%;margin-top:12px;" onclick="closeDemoPicker()"></button>
  </div>
</div>

<!-- Reorder overlay -->
<div class="reorder-overlay" id="reorderOverlay" onclick="closeReorder()">
  <div class="reorder-modal" onclick="event.stopPropagation()">
    <h3> </h3>
    <p class="reorder-hint"></p>
    <div class="reorder-list" id="reorderList"></div>
    <button class="reorder-done-btn" onclick="closeReorder()"></button>
  </div>
</div>

<div class="confirm-overlay" id="confirmOverlay" onclick="closeConfirm()">
  <div class="confirm-modal" onclick="event.stopPropagation()">
    <div class="confirm-icon"></div>
    <h3 id="confirmTitle"></h3>
    <p id="confirmDesc"></p>
    <div class="confirm-buttons">
      <button class="confirm-cancel" onclick="closeConfirm()"></button>
      <button class="confirm-danger" id="confirmDangerBtn"></button>
    </div>
  </div>
</div>

<!-- Deck Edit overlay -->
<div class="deck-edit-overlay" id="deckEditOverlay" onclick="closeDeckEdit()">
  <div class="deck-edit-modal" onclick="event.stopPropagation()">
    <h3 id="deckEditTitle"> </h3>
    <div class="deck-edit-name-row">
      <input type="text" id="deckEditNameInput" placeholder="" autocomplete="off">
      <button onclick="saveDeckName()"></button>
    </div>
    <div class="deck-edit-actions">
      <button class="deck-edit-btn" onclick="closeDeckEdit();openReorderModal()"><span class="de-icon"></span> </button>
      <button class="deck-edit-btn danger" onclick="closeDeckEdit();deleteDeck(activeDeckId)"><span class="de-icon"></span> </button>
    </div>
  </div>
</div>

<div class="confirm-overlay" id="renameOverlay" onclick="closeRename()">
  <div class="confirm-modal" onclick="event.stopPropagation()">
    <div class="confirm-icon"></div>
    <h3></h3>
    <div id="renameInput" class="rename-input rename-editable" contenteditable="true" role="textbox" data-placeholder=""></div>
    <div class="confirm-buttons">
      <button class="confirm-cancel" onclick="closeRename()"></button>
      <button class="confirm-danger" style="background:var(--orange-500);box-shadow:0 4px 12px rgba(255,140,0,0.3);" id="renameConfirmBtn"></button>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
// ============ STATE ============
// decks: { id, name, words: [{ english, japanese, level, correctStreak }] }
let decks = [];
let activeDeckId = null;
let currentQuiz = null;
let quizMode = ''; // 'quiz' (4) or 'flashcard' ()
let selectedRange = 'all';

const LEVELS = {
  unlearned: { label: '', badge: 'badge-unlearned' },
  weak: { label: '', badge: 'badge-weak' },
  fuzzy: { label: '', badge: 'badge-fuzzy' },
  mastered: { label: '', badge: 'badge-mastered' }
};

// ============ AUDIO SYSTEM ============
let audioCtx = null;
let audioEnabled = false;
let soundMuted = false; // Always on

function initAudio() {
  try {
    // If context exists but is in a bad state, destroy it
    if (audioCtx && (audioCtx.state === 'closed' || audioCtx.state === 'suspended')) {
      try { audioCtx.close(); } catch(e) {}
      audioCtx = null;
    }
    if (!audioCtx) {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    }
    if (audioCtx.state === 'suspended') {
      audioCtx.resume().catch(() => {});
    }
    audioEnabled = true;
  } catch(e) { audioEnabled = false; }
}

function toggleSound() {}

document.addEventListener('DOMContentLoaded', () => {});

// Unlock and keep audio alive on every user interaction (iOS kills AudioContext in background)
document.addEventListener('touchstart', initAudio, { passive: true });
document.addEventListener('touchend', initAudio, { passive: true });
document.addEventListener('click', initAudio);

// Visibility change: force recreate audio context when coming back
document.addEventListener('visibilitychange', () => {
  if (!document.hidden) {
    // Force destroy and recreate on next interaction
    if (audioCtx) {
      try { audioCtx.close(); } catch(e) {}
      audioCtx = null;
      audioEnabled = false;
    }
    // iOS Safari fix: when returning from file picker or background,
    // ensure no phantom focus/touch state is blocking interactions
    setTimeout(() => {
      if (document.activeElement && document.activeElement.tagName === 'INPUT' && document.activeElement.type === 'file') {
        document.activeElement.blur();
      }
    }, 100);
  }
});

// Periodic check: if context got suspended somehow, fix it
setInterval(() => {
  if (audioCtx && audioCtx.state === 'suspended') {
    audioCtx.resume().catch(() => {});
  }
}, 3000);

function playTone(freq, duration, type, vol) {
  if (soundMuted) return;
  // Always try to ensure audio context is alive
  if (!audioCtx || audioCtx.state === 'closed') {
    try {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      audioEnabled = true;
    } catch(e) { return; }
  }
  if (audioCtx.state === 'suspended') {
    audioCtx.resume().catch(() => {});
  }
  try {
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.type = type || 'sine';
  osc.frequency.value = freq;
  gain.gain.value = vol || 0.15;
  gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + (duration || 0.2));
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime + (duration || 0.2));
  } catch(e) { /* audio context may be in bad state, ignore */ }
}

// Sound effects
function sfxTap() { playTone(800, 0.08, 'sine', 0.18); }
function sfxSelect() { playTone(600, 0.06, 'sine', 0.15); playTone(900, 0.06, 'sine', 0.15); }
function sfxCorrect() {
  playTone(523, 0.12, 'sine', 0.22);
  setTimeout(() => playTone(659, 0.12, 'sine', 0.22), 80);
  setTimeout(() => playTone(784, 0.18, 'sine', 0.22), 160);
}
function sfxWrong() {
  playTone(300, 0.15, 'square', 0.15);
  setTimeout(() => playTone(250, 0.2, 'square', 0.15), 120);
}
function sfxReveal() { playTone(440, 0.1, 'triangle', 0.18); }
function sfxBookmark() {
  playTone(700, 0.08, 'sine', 0.18);
  setTimeout(() => playTone(1050, 0.12, 'sine', 0.2), 60);
}
function sfxStart() {
  playTone(523, 0.1, 'sine', 0.2);
  setTimeout(() => playTone(659, 0.1, 'sine', 0.2), 100);
  setTimeout(() => playTone(784, 0.1, 'sine', 0.2), 200);
  setTimeout(() => playTone(1047, 0.2, 'sine', 0.22), 300);
}
function sfxComplete() {
  [523, 659, 784, 1047].forEach((f, i) => {
    setTimeout(() => playTone(f, 0.2, 'sine', 0.2), i * 120);
  });
  setTimeout(() => {
    [1047, 1319, 1568].forEach((f, i) => {
      setTimeout(() => playTone(f, 0.25, 'sine', 0.18), i * 100);
    });
  }, 500);
}
function sfxBack() { playTone(500, 0.06, 'sine', 0.06); }

// ============ TTS (Text-to-Speech) ============
let ttsVoicesLoaded = false;
let ttsVoiceCache = {};

function loadVoices() {
  if (!('speechSynthesis' in window)) return;
  const voices = window.speechSynthesis.getVoices();
  if (voices.length > 0) {
    ttsVoicesLoaded = true;
    // Cache best voice per language
    ttsVoiceCache['en'] = voices.find(v => v.lang === 'en-US' && !v.localService)
      || voices.find(v => v.lang === 'en-US')
      || voices.find(v => v.lang.startsWith('en'));
    ttsVoiceCache['ja'] = voices.find(v => v.lang === 'ja-JP' && !v.localService)
      || voices.find(v => v.lang === 'ja-JP')
      || voices.find(v => v.lang.startsWith('ja'));
    ttsVoiceCache['ko'] = voices.find(v => v.lang === 'ko-KR' && !v.localService)
      || voices.find(v => v.lang === 'ko-KR')
      || voices.find(v => v.lang.startsWith('ko'));
    ttsVoiceCache['zh'] = voices.find(v => v.lang === 'zh-CN' && !v.localService)
      || voices.find(v => v.lang.startsWith('zh'));
    ttsVoiceCache['fr'] = voices.find(v => v.lang.startsWith('fr'));
    ttsVoiceCache['de'] = voices.find(v => v.lang.startsWith('de'));
    ttsVoiceCache['es'] = voices.find(v => v.lang.startsWith('es'));
  }
}

// Auto-detect language from text
function detectLang(text) {
  if (!text) return 'en';
  // Korean: Hangul block
  if (/[\uAC00-\uD7AF\u1100-\u11FF]/.test(text)) return 'ko';
  // Japanese: Hiragana, Katakana  definitely Japanese
  if (/[\u3040-\u309F\u30A0-\u30FF]/.test(text)) return 'ja';
  // CJK ideographs only (kanji only)  default to Japanese (this app's primary use)
  // Chinese would need explicit detection via simplified-only chars
  if (/[\u4E00-\u9FFF]/.test(text)) {
    // Check for simplified Chinese-only characters (not used in Japanese)
    if (/[\u4E07\u4E1C\u4E60\u4E66\u4E86\u4EA7\u4EEC\u4F1A\u5173\u51FA\u5BF9\u5C14\u6001\u62A5\u65F6\u8FD9\u8FC7\u8BF7\u8BA9\u8BDD\u7ECF\u8D5E]/.test(text)) return 'zh';
    return 'ja';
  }
  // French common patterns
  if (/[]/.test(text.toLowerCase())) return 'fr';
  // German common patterns
  if (/[]/.test(text.toLowerCase())) return 'de';
  // Spanish
  if (/[]/.test(text)) return 'es';
  // If mostly ASCII letters  English
  if (/^[a-zA-Z\s\-'.,;:!?()\d/]+$/.test(text)) return 'en';
  return 'en';
}

function speakText(text) {
  if (soundMuted || !('speechSynthesis' in window) || !text) return;
  // Stop any ongoing speech
  window.speechSynthesis.cancel();
  
  // Clean text: remove emojis, special markers, numbers-only prefixes
  let cleanText = text.replace(/[\u{1F000}-\u{1FFFF}]/gu, '').trim();
  // Skip if text is just numbers or symbols
  if (/^[\d\s.,:;!?()\/\-]+$/.test(cleanText)) return;
  
  const lang = detectLang(cleanText);
  const langMap = { en: 'en-US', ja: 'ja-JP', ko: 'ko-KR', zh: 'zh-CN', fr: 'fr-FR', de: 'de-DE', es: 'es-ES' };
  
  const u = new SpeechSynthesisUtterance(cleanText);
  u.lang = langMap[lang] || 'en-US';
  u.rate = lang === 'en' ? 0.85 : 1.0;
  u.volume = 0.45;
  
  // Set voice from cache
  if (ttsVoiceCache[lang]) {
    u.voice = ttsVoiceCache[lang];
  }
  
  // iOS workaround: speechSynthesis can get stuck, resume it
  if (window.speechSynthesis.paused) {
    window.speechSynthesis.resume();
  }
  
  window.speechSynthesis.speak(u);
  
  // iOS Safari bug workaround: keep alive with periodic resume
  let iosKeepAlive = setInterval(() => {
    if (!window.speechSynthesis.speaking) {
      clearInterval(iosKeepAlive);
    } else {
      window.speechSynthesis.pause();
      window.speechSynthesis.resume();
    }
  }, 5000);
  u.onend = () => clearInterval(iosKeepAlive);
  u.onerror = () => clearInterval(iosKeepAlive);
}

// Convenience aliases
function speakEN(text) { speakText(text); }
function speakJP(text) { speakText(text); }

// Stop all audio (TTS + SFX)
function stopAllAudio() {
  if ('speechSynthesis' in window) {
    window.speechSynthesis.cancel();
  }
}

// Preload voices
if ('speechSynthesis' in window) {
  loadVoices();
  window.speechSynthesis.onvoiceschanged = loadVoices;
  // Some browsers need a delay
  setTimeout(loadVoices, 500);
}

function getActiveDeck() {
  return decks.find(d => d.id === activeDeckId) || null;
}
function getActiveWords() {
  const deck = getActiveDeck();
  return deck ? deck.words : [];
}
// For 4-choice quiz, pull distractors from ALL decks
function getAllWords() {
  const all = [];
  decks.forEach(d => d.words.forEach(w => all.push(w)));
  return all;
}

// ============ PERSISTENCE ============
function saveState() {
  try {
    localStorage.setItem('mikan_decks', JSON.stringify(decks));
    localStorage.setItem('mikan_activeDeck', activeDeckId);
  } catch(e) {}
}

// Per-deck quiz settings persistence
function saveDeckSettings(deckId) {
  if (!deckId) return;
  try {
    const settings = {
      drillMode: quizDrillMode,
      reverse: reverseMode,
      tts: ttsMode,
      order: quizOrder
    };
    localStorage.setItem('mikan_deckSettings_' + deckId, JSON.stringify(settings));
  } catch(e) {}
}

function loadDeckSettings(deckId) {
  if (!deckId) return null;
  try {
    const raw = localStorage.getItem('mikan_deckSettings_' + deckId);
    if (raw) return JSON.parse(raw);
  } catch(e) {}
  return null;
}
function loadState() {
  try {
    // Migration from old format
    const oldWords = localStorage.getItem('mikan_words');
    if (oldWords) {
      const parsed = JSON.parse(oldWords);
      if (parsed.length > 0) {
        decks = [{ id: generateId(), name: '', words: parsed }];
        activeDeckId = decks[0].id;
        localStorage.removeItem('mikan_words');
        saveState();
        showScreen('dashboard');
        renderDeckList();
        updateDashboard();
        return;
      }
    }

    const saved = localStorage.getItem('mikan_decks');
    if (saved) {
      decks = JSON.parse(saved);
      activeDeckId = localStorage.getItem('mikan_activeDeck');
      if (decks.length > 0) {
        if (!activeDeckId || !decks.find(d => d.id === activeDeckId)) {
          activeDeckId = decks[0].id;
        }
        showScreen('dashboard');
        renderDeckList();
        updateDashboard();
      }
    }
  } catch(e) {}
}

function generateId() {
  return Date.now().toString(36) + Math.random().toString(36).slice(2, 7);
}

// ============ CSV IMPORT ============
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');

dropZone.addEventListener('click', () => fileInput.click());
dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.classList.add('dragover'); });
dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));
dropZone.addEventListener('drop', (e) => {
  e.preventDefault();
  dropZone.classList.remove('dragover');
  if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
});
fileInput.addEventListener('change', (e) => { 
  if (e.target.files.length) handleFile(e.target.files[0]); 
  e.target.value = '';
  e.target.blur();
});

function handleFile(file) {
  const reader = new FileReader();
  reader.onload = (e) => {
    const text = e.target.result;
    const name = file.name.replace(/\.(csv|txt)$/i, '') || '';
    addDeckFromCSV(text, name);
  };
  reader.readAsText(file, 'UTF-8');
}

function handleFileAdd(file) {
  if (!file) return;
  const fileInput = document.getElementById('fileInputAdd');
  fileInput.value = '';
  fileInput.blur();
  handleFile(file);
}

function addDeckFromCSV(text, deckName) {
  const lines = text.split(/\r?\n/).filter(l => l.trim());
  const words = [];

  for (const line of lines) {
    const parts = parseCSVLine(line);
    if (parts.length >= 2) {
      const english = parts[0].trim();
      const japanese = parts[1].trim();
      if (english && japanese && english !== '' && english !== '') {
        words.push({ english, japanese, level: 'unlearned', correctStreak: 0 });
      }
    }
  }

  if (words.length > 0) {
    const deck = { id: generateId(), name: deckName, words };
    decks.push(deck);
    activeDeckId = deck.id;
    saveState();
    showScreen('dashboard');
    renderDeckList();
    updateDashboard();
    showToast(`${deckName}${words.length}`);
  } else {
    showToast('');
  }
}

// Parse a single CSV line respecting quoted fields
function parseCSVLine(line) {
  const result = [];
  let current = '';
  let inQuotes = false;
  for (let i = 0; i < line.length; i++) {
    const ch = line[i];
    if (inQuotes) {
      if (ch === '"' && line[i+1] === '"') {
        current += '"'; i++;
      } else if (ch === '"') {
        inQuotes = false;
      } else {
        current += ch;
      }
    } else {
      if (ch === '"') {
        inQuotes = true;
      } else if (ch === ',' || ch === '\t') {
        result.push(current);
        current = '';
      } else {
        current += ch;
      }
    }
  }
  result.push(current);
  return result;
}

// ============ FORMAT EXAMPLES & HELP ============
const formatExamples = [
  `abandon,<br>accomplish,<br>adequate,`,
  `,1185<br>,1600<br>,1868`,
  `,2<br>,r<br>,`,
  `80025%,1000<br>A12B6,4`,
  `,<br>25,`,
  `,<br>,<br>,8`
];

function switchFormatTab(index, el) {
  el.parentElement.querySelectorAll('.format-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('formatExample').innerHTML = formatExamples[index];
}

function showHelp() {
  document.getElementById('helpOverlay').classList.add('show');
}
function closeHelp() {
  document.getElementById('helpOverlay').classList.remove('show');
}

function loadDemo() {
  document.getElementById('demoPickerOverlay').classList.add('show');
}

function closeDemoPicker() {
  document.getElementById('demoPickerOverlay').classList.remove('show');
}

function loadDemoData(key) {
  closeDemoPicker();
  const data = DEMO_DECKS[key];
  if (data) {
    addDeckFromCSV(data.csv, data.name);
  }
}

const DEMO_DECKS = {
  korean: {
    name: ' ',
    csv: `,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,
,`
  },
  education_law: {
    name: '',
    csv: `"",""
"",""
"1",""
"2",""
"4",""
"5","9"
"6",""
"9",""
"21","10"
"37",""`
  },
  curriculum: {
    name: '',
    csv: `"",""
"",""
"",""
"",""
"",""
"",""
"",""
"",""
"1","45"
"","34"`
  },
  student_guidance: {
    name: '',
    csv: `"",""
"",""
"",""
"",""
"",""
"1",""
"",""
"",""
"",""
"",""`
  },
  pe_exam: {
    name: ' ',
    csv: `"",""
"",""
"1",""
"2",""
"4",""
"",""
"",""
"",""
"",""
"",""`
  },
  kochi_exam: {
    name: ' ',
    csv: `"",""
"",""
"",""
"","711"
"",""
"",""
"",""
"",""
"",""
"PDCAPDCA","PlanDoCheckAction"`
  }
};

// ============ DECK LIST ============
// ============ HORIZONTAL DECK CAROUSEL (CIRCULAR) ============
const CARD_W = 142; // card width + margins
let carouselOffset = 0;
let carouselVelocity = 0;
let carouselDragging = false;
let carouselEventsReady = false;
// For circular: we track which "logical index" is centered
let carouselCenterIdx = 0;

function buildDonutSVG(counts, total) {
  const t = total || 1;
  const R = 17, C = 2 * Math.PI * R;
  //  Merge fuzzy+mastered as green
  const greenPct = (counts.mastered + counts.fuzzy) / t;
  const slices = [
    { pct: greenPct, color: '#22C55E' },
    { pct: counts.weak / t, color: '#EF4444' },
    { pct: counts.unlearned / t, color: '#D1D5DB' }
  ];
  let offset = 0;
  let circles = '';
  slices.forEach(s => {
    if (s.pct <= 0) return;
    const len = s.pct * C;
    //  No rotate needed: stroke-dashoffset from 12 o'clock (SVG default with no transform)
    circles += `<circle cx="24" cy="24" r="${R}" stroke="${s.color}" stroke-dasharray="${len} ${C - len}" stroke-dashoffset="${-offset}" />`;
    offset += len;
  });
  if (offset === 0) circles = `<circle cx="24" cy="24" r="${R}" stroke="#D1D5DB" stroke-dasharray="${C} 0" />`;
  const pct = Math.round(((counts.mastered + counts.fuzzy) / t) * 100);
  //  rotate(-90deg) starts from 12 o'clock
  return `<svg viewBox="0 0 48 48"><g style="transform:rotate(-90deg);transform-origin:center">${circles}</g></svg>
    <div class="dc-donut-center"><span class="dc-pct">${pct}%</span><span class="dc-pct-label"></span></div>`;
}

// Build the visible card array for circular layout:
// We render enough cards to fill the viewport, repeating from the circular list
function getVisibleCards() {
  if (decks.length === 0) return [];
  const n = decks.length;
  // Show up to 7 cards around center (3 left, center, 3 right)
  const spread = Math.min(3, Math.max(1, Math.ceil(n / 2)));
  const cards = [];
  for (let d = -spread; d <= spread; d++) {
    const realIdx = ((carouselCenterIdx + d) % n + n) % n;
    cards.push({ deck: decks[realIdx], realIdx, offset: d });
  }
  return cards;
}

function renderDeckList() {
  if (decks.length === 0) return;
  const track = document.getElementById('carouselTrack');
  if (!track) return;

  const activeIdx = decks.findIndex(d => d.id === activeDeckId);
  carouselCenterIdx = activeIdx >= 0 ? activeIdx : 0;
  carouselOffset = 0; // 0 means center card is at center

  rebuildCarouselCards();

  const countEl = document.getElementById('deckPickerCount');
  if (countEl) countEl.textContent = `${carouselCenterIdx + 1} / ${decks.length}`;

  if (!carouselEventsReady) {
    initCarouselEvents();
    carouselEventsReady = true;
  }
}

function rebuildCarouselCards() {
  const track = document.getElementById('carouselTrack');
  const vp = document.getElementById('carouselViewport');
  if (!track || !vp) return;

  const cards = getVisibleCards();
  const vpW = vp.clientWidth;
  const centerX = vpW / 2 - CARD_W / 2;

  track.innerHTML = cards.map(c => {
    const counts = { unlearned: 0, weak: 0, fuzzy: 0, mastered: 0 };
    c.deck.words.forEach(w => { if (counts[w.level] !== undefined) counts[w.level]++; });
    const total = c.deck.words.length;
    const x = centerX + c.offset * CARD_W + carouselOffset;
    const isActive = c.offset === 0 && carouselOffset === 0;
    return `
      <div class="deck-card ${isActive ? 'active' : ''}" 
           data-real="${c.realIdx}" data-offset="${c.offset}"
           onclick="carouselTapCard(${c.realIdx}, ${c.offset})"
           style="position:absolute;left:${x}px;top:8px;">
        <div class="dc-donut">${buildDonutSVG(counts, total)}</div>
        <div class="dc-name">${escapeHtml(c.deck.name)}</div>
        <div class="dc-meta">${c.deck.words.length}</div>
      </div>
    `;
  }).join('');
}

function applyCarouselTransform(animate) {
  const track = document.getElementById('carouselTrack');
  const vp = document.getElementById('carouselViewport');
  if (!track || !vp) return;

  const vpW = vp.clientWidth;
  const centerX = vpW / 2 - CARD_W / 2;
  const cards = track.querySelectorAll('.deck-card');

  cards.forEach(card => {
    const d = parseInt(card.dataset.offset);
    const x = centerX + d * CARD_W + carouselOffset;
    card.style.transition = animate ? 'left 0.35s cubic-bezier(.23,1,.32,1), transform 0.35s, opacity 0.35s, border-color 0.35s, box-shadow 0.35s' : 'none';
    card.style.left = x + 'px';

    // Active state based on distance from center
    const distFromCenter = Math.abs(d * CARD_W + carouselOffset);
    card.classList.toggle('active', distFromCenter < CARD_W * 0.35);
  });
}

function snapCarousel(animate) {
  // Find which card offset is closest to center (offset 0)
  const shiftCards = Math.round(-carouselOffset / CARD_W);
  const n = decks.length;

  if (shiftCards !== 0) {
    carouselCenterIdx = ((carouselCenterIdx + shiftCards) % n + n) % n;
    carouselOffset = 0;
    rebuildCarouselCards();
  } else {
    carouselOffset = 0;
  }
  applyCarouselTransform(animate !== false);

  // Update active deck
  if (decks[carouselCenterIdx] && decks[carouselCenterIdx].id !== activeDeckId) {
    activeDeckId = decks[carouselCenterIdx].id;
    sfxSelect();
    saveState();
    updateDashboard();
  }
  const countEl = document.getElementById('deckPickerCount');
  if (countEl) countEl.textContent = `${carouselCenterIdx + 1} / ${decks.length}`;
}

function carouselTapCard(realIdx, offset) {
  // Tapping the center card  open edit
  if (offset === 0 && carouselOffset === 0) {
    openDeckEdit(decks[realIdx].id);
    return;
  }
  // Otherwise, shift to that card
  carouselCenterIdx = realIdx;
  activeDeckId = decks[realIdx].id;
  sfxSelect();
  saveState();
  carouselOffset = 0;
  rebuildCarouselCards();
  applyCarouselTransform(true);
  updateDashboard();
  const countEl = document.getElementById('deckPickerCount');
  if (countEl) countEl.textContent = `${realIdx + 1} / ${decks.length}`;
}

function initCarouselEvents() {
  const vp = document.getElementById('carouselViewport');
  if (!vp) return;
  let startX = 0, lastX = 0, lastTime = 0, startOff = 0, hasMoved = false;

  //  Fix: prevent page scroll during horizontal carousel swipe
  vp.addEventListener('touchstart', (e) => {
    carouselDragging = true;
    hasMoved = false;
    startX = lastX = e.touches[0].clientX;
    lastTime = Date.now();
    startOff = carouselOffset;
    carouselVelocity = 0;
  }, { passive: true });

  vp.addEventListener('touchmove', (e) => {
    if (!carouselDragging) return;
    const x = e.touches[0].clientX;
    const dx = Math.abs(x - startX);
    if (dx > 8) {
      hasMoved = true;
      e.preventDefault(); //  prevent page scroll
    }
    const now = Date.now();
    if (now - lastTime > 0) carouselVelocity = (x - lastX) / (now - lastTime);
    lastX = x; lastTime = now;
    carouselOffset = startOff + (x - startX);
    applyCarouselTransform(false);
  }, { passive: false }); //  must be non-passive to preventDefault

  vp.addEventListener('touchend', () => {
    if (!carouselDragging) return;
    carouselDragging = false;
    if (!hasMoved) return;
    carouselOffset += carouselVelocity * 100;
    snapCarousel(true);
  });

  // Mouse
  vp.addEventListener('mousedown', (e) => {
    e.preventDefault();
    carouselDragging = true;
    hasMoved = false;
    startX = lastX = e.clientX;
    lastTime = Date.now();
    startOff = carouselOffset;
    carouselVelocity = 0;
    const onMove = (ev) => {
      if (!carouselDragging) return;
      const x = ev.clientX;
      if (Math.abs(x - startX) > 5) hasMoved = true;
      const now = Date.now();
      if (now - lastTime > 0) carouselVelocity = (x - lastX) / (now - lastTime);
      lastX = x; lastTime = now;
      carouselOffset = startOff + (x - startX);
      applyCarouselTransform(false);
    };
    const onUp = () => {
      carouselDragging = false;
      document.removeEventListener('mousemove', onMove);
      document.removeEventListener('mouseup', onUp);
      if (!hasMoved) return;
      carouselOffset += carouselVelocity * 100;
      snapCarousel(true);
    };
    document.addEventListener('mousemove', onMove);
    document.addEventListener('mouseup', onUp);
  });

  // Wheel
  vp.addEventListener('wheel', (e) => {
    e.preventDefault();
    const delta = Math.abs(e.deltaX) > Math.abs(e.deltaY) ? e.deltaX : e.deltaY;
    carouselOffset -= delta > 0 ? CARD_W : -CARD_W;
    snapCarousel(true);
  }, { passive: false });
}

function selectDeck(id) {
  sfxSelect();
  activeDeckId = id;
  saveState();
  renderDeckList();
  updateDashboard();
}

// ============ REORDER DECKS ============
function openReorderModal() {
  if (decks.length < 2) {
    showToast('2');
    return;
  }
  renderReorderList();
  document.getElementById('reorderOverlay').classList.add('show');
}

function closeReorder() {
  document.getElementById('reorderOverlay').classList.remove('show');
}

function renderReorderList() {
  const list = document.getElementById('reorderList');
  list.innerHTML = decks.map((deck, i) => `
    <div class="reorder-item" data-index="${i}">
      <div class="ro-arrows">
        <button class="ro-arrow-btn" onclick="moveDeckInList(${i}, -1)" ${i === 0 ? 'disabled' : ''}></button>
        <button class="ro-arrow-btn" onclick="moveDeckInList(${i}, 1)" ${i === decks.length - 1 ? 'disabled' : ''}></button>
      </div>
      <div class="ro-name">${escapeHtml(deck.name)}</div>
      <div class="ro-count">${deck.words.length}</div>
    </div>
  `).join('');
}

function moveDeckInList(fromIdx, direction) {
  const toIdx = fromIdx + direction;
  if (toIdx < 0 || toIdx >= decks.length) return;
  sfxTap();
  // Swap
  const temp = decks[fromIdx];
  decks[fromIdx] = decks[toIdx];
  decks[toIdx] = temp;
  saveState();
  renderReorderList();
  renderDeckList();
  updateDashboard();
}

// ============ DECK EDIT MODAL ============
function openDeckEdit(id) {
  const deck = decks.find(d => d.id === id);
  if (!deck) return;
  const input = document.getElementById('deckEditNameInput');
  input.value = deck.name;
  input.onkeydown = (e) => { if (e.key === 'Enter') { e.preventDefault(); saveDeckName(); } };
  document.getElementById('deckEditOverlay').classList.add('show');
  setTimeout(() => { input.focus(); input.select(); }, 200);
}

function closeDeckEdit() {
  document.getElementById('deckEditOverlay').classList.remove('show');
}

function saveDeckName() {
  const input = document.getElementById('deckEditNameInput');
  const newName = input.value.trim();
  if (!newName) return;
  const deck = decks.find(d => d.id === activeDeckId);
  if (deck) {
    deck.name = newName;
    saveState();
    renderDeckList();
    showToast('');
  }
  closeDeckEdit();
}

function deleteDeck(id) {
  const deck = decks.find(d => d.id === id);
  if (!deck) return;
  confirmAction('', '' + deck.name + '', function() {
    decks = decks.filter(d => d.id !== id);
    if (activeDeckId === id) {
      activeDeckId = decks.length > 0 ? decks[0].id : null;
    }
    saveState();
    try { localStorage.removeItem('mikan_deckSettings_' + id); } catch(e) {}
    if (decks.length === 0) {
      showScreen('import');
    } else {
      renderDeckList();
      updateDashboard();
    }
    showToast('');
  }, '');
}

let renamingDeckId = null;

function renameDeck(id) {
  const deck = decks.find(d => d.id === id);
  if (!deck) return;
  renamingDeckId = id;
  const input = document.getElementById('renameInput');
  input.textContent = deck.name;
  document.getElementById('renameOverlay').classList.add('show');
  setTimeout(() => {
    input.focus();
    // Place cursor at end
    const range = document.createRange();
    range.selectNodeContents(input);
    range.collapse(false);
    const sel = window.getSelection();
    sel.removeAllRanges();
    sel.addRange(range);
  }, 100);
  // Prevent Enter key from adding line break
  input.onkeydown = function(e) {
    if (e.key === 'Enter') { e.preventDefault(); document.getElementById('renameConfirmBtn').click(); }
  };
  // Prevent paste from adding HTML
  input.onpaste = function(e) {
    e.preventDefault();
    const text = (e.clipboardData || window.clipboardData).getData('text/plain');
    document.execCommand('insertText', false, text);
  };
  document.getElementById('renameConfirmBtn').onclick = function() {
    const newName = input.textContent.trim();
    if (!newName) return;
    deck.name = newName;
    saveState();
    renderDeckList();
    closeRename();
    showToast('');
  };
}

function closeRename() {
  document.getElementById('renameOverlay').classList.remove('show');
  renamingDeckId = null;
}

function escapeHtml(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

// ============ SCREENS ============
function showScreen(name) {
  sfxTap();
  stopAllAudio();
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(`screen-${name}`).classList.add('active');
  window.scrollTo(0, 0);
}

// ============ DASHBOARD ============
function updateDashboard() {
  const words = getActiveWords();
  const counts = { unlearned: 0, weak: 0, fuzzy: 0, mastered: 0, bookmarked: 0 };
  words.forEach(w => {
    if (w.level === 'almost') w.level = 'mastered';
    if (counts[w.level] !== undefined) counts[w.level]++;
    if (w.bookmarked) counts.bookmarked++;
  });

  const total = words.length || 1;
  const pct = Math.round((counts.mastered / total) * 100);

  // Update donut center
  const pctEl = document.getElementById('donutPct');
  if (pctEl) {
    pctEl.textContent = pct + '%';
    // Color transitions: redyellowgreen based on percentage
    if (pct >= 80) pctEl.style.color = 'var(--green-500)';
    else if (pct >= 40) pctEl.style.color = 'var(--yellow-500)';
    else pctEl.style.color = 'var(--gray-500)';
  }

  // Draw donut rings (SVG)
  const ringsEl = document.getElementById('donutRings');
  if (ringsEl) {
    const segments = [
      { level: 'mastered', count: counts.mastered, color: '#22C55E' },
      { level: 'fuzzy', count: counts.fuzzy, color: '#EAB308' },
      { level: 'weak', count: counts.weak, color: '#EF4444' },
      { level: 'unlearned', count: counts.unlearned, color: '#D1D5DB' },
    ];
    const R = 40, STROKE = 14;
    const C = 2 * Math.PI * R;
    let offset = 0;
    let svg = '';
    // Background ring
    svg += `<circle cx="50" cy="50" r="${R}" fill="none" stroke="#F3F4F6" stroke-width="${STROKE}"/>`;
    segments.forEach(seg => {
      if (seg.count <= 0) return;
      const len = (seg.count / total) * C;
      svg += `<circle cx="50" cy="50" r="${R}" fill="none"
        stroke="${seg.color}" stroke-width="${STROKE}"
        stroke-dasharray="${len} ${C - len}"
        stroke-dashoffset="${-offset}"
        stroke-linecap="butt"
        style="transition: stroke-dasharray 0.6s ease, stroke-dashoffset 0.6s ease;"/>`;
      offset += len;
    });
    ringsEl.innerHTML = svg;
  }

  // Draw legend
  const legendEl = document.getElementById('donutLegend');
  if (legendEl) {
    const items = [
      { key: 'mastered', label: '', color: '#22C55E', count: counts.mastered },
      { key: 'fuzzy', label: '', color: '#EAB308', count: counts.fuzzy },
      { key: 'weak', label: '', color: '#EF4444', count: counts.weak },
      { key: 'unlearned', label: '', color: '#D1D5DB', count: counts.unlearned },
    ];
    legendEl.innerHTML = items.map(it => `
      <div class="donut-legend-item ${it.count === 0 ? 'disabled' : ''}"
           onclick="${it.count > 0 ? `showQuizSetupWithLevel('${it.key}')` : ''}">
        <div class="donut-legend-dot" style="background:${it.color}"></div>
        <span class="donut-legend-name">${it.label}</span>
        <span class="donut-legend-count">${it.count}</span>
      </div>
    `).join('');
  }

  // Update progress bar
  const bar = document.getElementById('progressBar');
  if (bar) {
    bar.innerHTML = '';
    ['mastered', 'fuzzy', 'weak'].forEach(level => {
      if (counts[level] > 0) {
        const seg = document.createElement('div');
        seg.className = `progress-segment ${level}`;
        seg.style.width = `${(counts[level] / total) * 100}%`;
        bar.appendChild(seg);
      }
    });
  }

  // Celebration: all words mastered!
  if (words.length > 0 && counts.mastered === words.length) {
    showCelebration();
  }
}

function showCelebration() {
  // Only show once per deck completion
  const deck = getActiveDeck();
  if (!deck) return;
  const key = 'celebrated_' + deck.id;
  if (localStorage.getItem(key) === String(deck.words.length)) return;
  localStorage.setItem(key, String(deck.words.length));

  const overlay = document.getElementById('celebrationOverlay');
  if (!overlay) return;
  const deckName = deck.name;
  document.getElementById('celebrationDeck').textContent = deckName;
  document.getElementById('celebrationCount').textContent = deck.words.length;
  overlay.classList.add('show');
  sfxComplete();
  setTimeout(() => sfxComplete(), 800);

  // Confetti
  launchConfetti();
}

function closeCelebration() {
  document.getElementById('celebrationOverlay').classList.remove('show');
}

function launchConfetti() {
  const canvas = document.getElementById('confettiCanvas');
  if (!canvas) return;
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
  const colors = ['#FF8C00','#22C55E','#3B82F6','#EF4444','#FACC15','#A855F7','#EC4899'];
  const pieces = [];
  for (let i = 0; i < 100; i++) {
    pieces.push({
      x: Math.random() * canvas.width,
      y: -20 - Math.random() * 200,
      w: 6 + Math.random() * 6,
      h: 4 + Math.random() * 4,
      color: colors[Math.floor(Math.random() * colors.length)],
      vy: 2 + Math.random() * 3,
      vx: (Math.random() - 0.5) * 3,
      rot: Math.random() * 360,
      rotSpeed: (Math.random() - 0.5) * 10
    });
  }
  let frame = 0;
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    pieces.forEach(p => {
      p.y += p.vy;
      p.x += p.vx;
      p.rot += p.rotSpeed;
      p.vy += 0.05;
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot * Math.PI / 180);
      ctx.fillStyle = p.color;
      ctx.fillRect(-p.w/2, -p.h/2, p.w, p.h);
      ctx.restore();
    });
    frame++;
    if (frame < 180) requestAnimationFrame(draw);
    else ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
  draw();
}

// ============ LEVEL SELECT ============
function showLevelSelect() {
  showScreen('level-select');
  const words = getActiveWords();
  const bookmarkedCount = words.filter(w => w.bookmarked).length;
  const counts = { unlearned: 0, weak: 0, fuzzy: 0, mastered: 0 };
  words.forEach(w => {
    if (w.level === 'almost') w.level = 'mastered';
    if (counts[w.level] !== undefined) counts[w.level]++;
  });

  const allMastered = words.length > 0 && counts.mastered === words.length;

  const options = [
    { key: 'all', icon: allMastered ? '' : '', label: '', count: words.length, cls: 'all', locked: !allMastered },
    { key: 'bookmarked', icon: '', label: '', count: bookmarkedCount, cls: 'bookmarked' },
    { key: 'unlearned', icon: '', label: '', count: counts.unlearned, cls: 'unlearned' },
    { key: 'weak', icon: '', label: '', count: counts.weak, cls: 'weak' },
    { key: 'fuzzy', icon: '', label: '', count: counts.fuzzy, cls: 'fuzzy' },
    { key: 'mastered', icon: '', label: '', count: counts.mastered, cls: 'mastered' },
  ];

  let html = '';

  // Praise banner when all mastered
  if (allMastered) {
    html += `
      <div class="level-praise-banner">
        <div class="praise-emoji"></div>
        <div class="praise-title"></div>
        <div class="praise-sub"><br></div>
      </div>
    `;
  }

  html += '<div class="level-select-row">';
  html += options.map(opt => {
    const disabled = opt.count === 0;
    const locked = opt.locked && !disabled;
    if (locked) {
      return `
      <div class="level-select-card ${opt.cls} locked" onclick="showLockedMessage()">
        <div class="ls-icon">${opt.icon}</div>
        <div class="ls-label">${opt.label}</div>
        <div class="ls-count">${opt.count}</div>
      </div>`;
    }
    return `
    <div class="level-select-card ${opt.cls} ${disabled ? 'disabled' : ''}" ${disabled ? '' : `onclick="showQuizSetupWithLevel('${opt.key}')"`}>
      <div class="ls-icon">${opt.icon}</div>
      <div class="ls-label">${opt.label}</div>
      <div class="ls-count">${opt.count}</div>
    </div>`;
  }).join('');
  html += '</div>';

  document.getElementById('levelSelectGrid').innerHTML = html;

  // Enable mouse wheel horizontal scroll on the row
  const row = document.querySelector('.level-select-row');
  if (row) {
    row.addEventListener('wheel', (e) => {
      if (Math.abs(e.deltaY) > Math.abs(e.deltaX)) {
        e.preventDefault();
        row.scrollLeft += e.deltaY;
      }
    }, { passive: false });
  }
}

function showLockedMessage() {
  showToast(' ');
}

// ============ QUIZ SETUP ============
let quizDrillMode = false;
let reviewMode = false;
let reverseMode = false;
let ttsMode = 'answer'; // 'question', 'answer', 'both', 'none'
let quizOrder = 'asc'; // 'asc', 'desc', 'random'

function startNextQuiz() {
  // Re-start a quiz with the same settings (range, mode, drill, reverse, tts, order, count)
  reviewMode = false;
  let pool = getQuizPool();
  if (pool.length === 0) {
    showToast('');
    return;
  }

  // Apply order
  if (quizOrder === 'random') {
    pool = pool.sort(() => Math.random() - 0.5);
  } else if (quizOrder === 'desc') {
    pool = pool.reverse();
  }

  // Use the same count as last quiz
  const lastCount = currentQuiz ? currentQuiz.totalCount : 10;
  const count = Math.min(lastCount, pool.length);
  pool = pool.slice(0, count);

  // Save original levels before quiz
  const beforeLevels = {};
  pool.forEach(w => { beforeLevels[w.english] = w.level; });

  currentQuiz = {
    words: pool,
    index: 0,
    correct: 0,
    wrong: 0,
    results: [],
    totalCount: pool.length,
    masteredCount: 0,
    beforeLevels: beforeLevels
  };

  showScreen('quiz');
  sfxStart();
  showQuizQuestion();
}

function startMissedReview() {
  const missed = currentQuiz.results.filter(r => !r.correct);
  const seen = new Set();
  const pool = missed.filter(r => {
    if (seen.has(r.word.english)) return false;
    seen.add(r.word.english);
    return true;
  }).map(r => r.word);

  if (pool.length === 0) return;

  pool.sort(() => Math.random() - 0.5);

  reviewMode = true;
  quizMode = 'flashcard';
  quizDrillMode = true;

  // Save current levels (won't be changed)
  const beforeLevels = {};
  pool.forEach(w => { beforeLevels[w.english] = w.level; });

  currentQuiz = {
    words: pool,
    index: 0,
    correct: 0,
    wrong: 0,
    results: [],
    totalCount: pool.length,
    masteredCount: 0,
    beforeLevels: beforeLevels
  };

  showScreen('quiz');
  sfxStart();
  showQuizQuestion();
} // false = normal, true = drill

let quizSetupFrom = 'dashboard';

function showQuizSetupWithLevel(level) {
  // Track where we came from
  const currentScreen = document.querySelector('.screen.active');
  if (currentScreen && currentScreen.id === 'screen-level-select') {
    quizSetupFrom = 'level-select';
  } else {
    quizSetupFrom = 'dashboard';
  }

  quizMode = 'flashcard';
  selectedRange = level;

  // Load saved settings for this deck, or use defaults
  const saved = loadDeckSettings(activeDeckId);
  if (saved) {
    quizDrillMode = saved.drillMode || false;
    reverseMode = saved.reverse || false;
    ttsMode = saved.tts || 'answer';
    quizOrder = saved.order || 'asc';
  } else {
    quizDrillMode = false;
    reverseMode = false;
    ttsMode = 'answer';
    quizOrder = 'asc';
  }

  showScreen('quiz-setup');

  // Apply UI to match loaded settings
  // Mode toggle (=0, =1)
  document.querySelectorAll('#modeToggle .mode-toggle-btn').forEach((b, i) => {
    b.classList.toggle('active', quizDrillMode ? i === 1 : i === 0);
  });
  document.getElementById('drillDesc').style.display = quizDrillMode ? 'block' : 'none';

  // Reverse toggle (=0, =1)
  document.querySelectorAll('#reverseToggle .mode-toggle-btn').forEach((b, i) => {
    b.classList.toggle('active', reverseMode ? i === 1 : i === 0);
  });

  // TTS toggle (=0, =1, =2, =3)
  const ttsIdx = { question: 0, answer: 1, both: 2, none: 3 }[ttsMode] ?? 1;
  document.querySelectorAll('#ttsToggle .mode-toggle-btn').forEach((b, i) => {
    b.classList.toggle('active', i === ttsIdx);
  });

  // Order toggle (=0, =1, =2)
  const orderIdx = { asc: 0, desc: 1, random: 2 }[quizOrder] ?? 0;
  document.querySelectorAll('#orderToggle .mode-toggle-btn').forEach((b, i) => {
    b.classList.toggle('active', i === orderIdx);
  });

  // Set back button
  document.getElementById('setupBackBtn').onclick = function() {
    showScreen(quizSetupFrom);
    if (quizSetupFrom === 'level-select') showLevelSelect();
  };

  // Title
  const levelNames = {
    all: '', unlearned: '', weak: '', fuzzy: '', mastered: '', bookmarked: ''
  };
  document.getElementById('setupTitle').textContent = levelNames[level] || level;

  updateStartBtn();
}

function selectMode(mode, el) {
  quizDrillMode = (mode === 'drill');
  el.parentElement.querySelectorAll('.mode-toggle-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('drillDesc').style.display = quizDrillMode ? 'block' : 'none';
  saveDeckSettings(activeDeckId);
}

function selectReverse(isReverse, el) {
  reverseMode = isReverse;
  el.parentElement.querySelectorAll('.mode-toggle-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  saveDeckSettings(activeDeckId);
}

function selectTTS(mode, el) {
  ttsMode = mode;
  el.parentElement.querySelectorAll('.mode-toggle-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  saveDeckSettings(activeDeckId);
}

function selectOrder(order, el) {
  quizOrder = order;
  el.parentElement.querySelectorAll('.mode-toggle-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
  saveDeckSettings(activeDeckId);
}

function updateStartBtn() {
  const btn = document.getElementById('startQuizBtn');
  const pool = getQuizPool();
  btn.disabled = pool.length === 0;
  btn.textContent = pool.length === 0 ? '' : '';
}

function getQuizPool() {
  const words = getActiveWords();
  if (selectedRange === 'all') return [...words];
  if (selectedRange === 'bookmarked') return words.filter(w => w.bookmarked);
  return words.filter(w => w.level === selectedRange);
}

// ============ QUIZ ============
function startQuiz() {
  reviewMode = false;
  let pool = getQuizPool();
  if (pool.length === 0) return;

  // Apply order
  if (quizOrder === 'random') {
    pool = pool.sort(() => Math.random() - 0.5);
  } else if (quizOrder === 'desc') {
    pool = pool.reverse();
  }
  // 'asc' = keep original list order (default from getQuizPool)

  const countSel = document.getElementById('quizCount').value;
  const count = countSel === 'all' ? pool.length : Math.min(parseInt(countSel), pool.length);
  pool = pool.slice(0, count);

  // Save original levels before quiz
  const beforeLevels = {};
  pool.forEach(w => { beforeLevels[w.english] = w.level; });

  currentQuiz = {
    words: pool,
    index: 0,
    correct: 0,
    wrong: 0,
    results: [],
    totalCount: pool.length,
    masteredCount: 0,
    beforeLevels: beforeLevels
  };

  showScreen('quiz');
  sfxStart();
  showQuizQuestion();
}

function showQuizQuestion() {
  const q = currentQuiz;
  const word = q.words[q.index];

  if (quizDrillMode) {
    document.getElementById('quizProgressText').textContent = `${q.masteredCount} / ${q.totalCount}`;
    document.getElementById('quizProgressFill').style.width = `${(q.masteredCount / q.totalCount) * 100}%`;
  } else {
    document.getElementById('quizProgressText').textContent = `${q.index + 1} / ${q.totalCount}`;
    document.getElementById('quizProgressFill').style.width = `${(q.index / q.totalCount) * 100}%`;
  }

  // Migrate old 'almost' level
  if (word.level === 'almost') word.level = 'mastered';

  const badge = document.getElementById('quizBadge');
  const levelInfo = LEVELS[word.level] || LEVELS.unlearned;
  badge.textContent = levelInfo.label;
  badge.className = `level-badge ${levelInfo.badge}`;

  //  Reverse mode: swap question/answer display
  const questionText = reverseMode ? word.japanese : word.english;
  const answerText = reverseMode ? word.english : word.japanese;

  const quizWordEl = document.getElementById('quizWord');
  quizWordEl.textContent = questionText;

  //  Auto-size: shrink font for long text
  autoSizeQuizWord(quizWordEl);

  // Read the question word aloud (respects ttsMode)
  if (ttsMode === 'question' || ttsMode === 'both') {
    speakText(questionText);
  }

  // Reset card state
  const card = document.getElementById('quizCard');
  card.classList.remove('revealed');
  
  // Update bookmark button in card
  const bkmBtn = document.getElementById('bookmarkBtn');
  if (bkmBtn) bkmBtn.classList.toggle('active', !!word.bookmarked);

  const answerReveal = document.getElementById('answerReveal');
  const body = document.getElementById('quizBody');

  // Answer area inside card (hint + hidden answer)
  answerReveal.innerHTML = `
    <div class="answer-tap-hint"><span class="tap-icon"></span> </div>
    <div class="answer-text-area">${escapeHtml(answerText)}</div>
  `;

  if (quizMode === 'flashcard') {
    body.innerHTML = `
      <div class="know-buttons-wrap">
        <div class="know-buttons" id="knowButtons" style="opacity:0.3;pointer-events:none;">
          <button class="know-btn dont-know" onclick="answerKnowledge(false)"></button>
          <button class="know-btn know" onclick="answerKnowledge(true)"></button>
        </div>
      </div>
    `;
  } else {
    const choices = generateChoices(word);
    const correctAnswer = word.japanese;
    body.innerHTML = `
      <div class="choices">
        ${choices.map((c, i) => `
          <button class="choice-btn" onclick="answerChoice(this, ${i}, ${c === correctAnswer})">${escapeHtml(c)}</button>
        `).join('')}
      </div>
    `;
  }
}

//  Auto-size quiz question text to fit within card
function autoSizeQuizWord(el) {
  el.style.fontSize = '';
  const sizes = [32, 26, 22, 18, 15, 13];
  for (const size of sizes) {
    el.style.fontSize = size + 'px';
    if (el.scrollHeight <= el.clientHeight + 4) return;
  }
}

function revealAnswer() {
  const card = document.getElementById('quizCard');
  if (!currentQuiz) return;
  const word = currentQuiz.words[currentQuiz.index];

  // Already revealed  re-read aloud on tap
  if (card.classList.contains('revealed')) {
    if (ttsMode === 'none') return;
    const questionText = reverseMode ? word.japanese : word.english;
    const answerText = reverseMode ? word.english : word.japanese;
    if (ttsMode === 'question') speakText(questionText);
    else if (ttsMode === 'answer') speakText(answerText);
    else if (ttsMode === 'both') speakTextSequence(questionText, answerText);
    return;
  }

  card.classList.add('revealed');
  sfxReveal();
  // Read the answer aloud (respects ttsMode)
  if (ttsMode === 'answer' || ttsMode === 'both') {
    const answerText = reverseMode ? word.english : word.japanese;
    setTimeout(() => speakText(answerText), 200);
  }
  // Enable the know/don't-know buttons
  const btns = document.getElementById('knowButtons');
  if (btns) {
    btns.style.opacity = '1';
    btns.style.pointerEvents = 'auto';
  }
}

function toggleBookmark() {
  const word = currentQuiz.words[currentQuiz.index];
  word.bookmarked = !word.bookmarked;
  sfxBookmark();
  const btn = document.getElementById('bookmarkBtn');
  btn.classList.toggle('active', word.bookmarked);
  saveState();
}

function generateChoices(targetWord) {
  const correct = targetWord.japanese;
  // Pull distractors from all decks for better variety
  const allW = getAllWords().filter(w => w.japanese !== correct);
  const shuffled = allW.sort(() => Math.random() - 0.5).slice(0, 3);
  const choices = [correct, ...shuffled.map(w => w.japanese)];
  return choices.sort(() => Math.random() - 0.5);
}

function answerKnowledge(known) {
  const word = currentQuiz.words[currentQuiz.index];

  if (known) {
    sfxCorrect();
    currentQuiz.correct++;
    if (!reviewMode) {
      if (word.level === 'unlearned') {
        word.level = 'fuzzy';
        word.correctStreak = 1;
      } else if (word.level === 'weak') {
        word.level = 'fuzzy';
        word.correctStreak = 1;
      } else if (word.level === 'fuzzy') {
        word.level = 'mastered';
        word.correctStreak = 2;
      }
    }
    currentQuiz.results.push({ word, correct: true });
    if (quizDrillMode) currentQuiz.masteredCount++;
  } else {
    sfxWrong();
    currentQuiz.wrong++;
    if (!reviewMode) {
      word.level = 'weak';
      word.correctStreak = 0;
    }
    currentQuiz.results.push({ word, correct: false });

    // Drill mode: re-queue the word later
    if (quizDrillMode) {
      const remaining = currentQuiz.words.slice(currentQuiz.index + 1);
      const insertPos = Math.min(2 + Math.floor(Math.random() * 4), remaining.length);
      remaining.splice(insertPos, 0, word);
      currentQuiz.words = [...currentQuiz.words.slice(0, currentQuiz.index + 1), ...remaining];
    }
  }

  saveState();
  nextQuestion();
}

function answerChoice(btn, index, isCorrect) {
  const allBtns = btn.parentElement.querySelectorAll('.choice-btn');
  allBtns.forEach(b => b.classList.add('disabled'));

  const word = currentQuiz.words[currentQuiz.index];

  if (isCorrect) {
    btn.classList.add('correct');
    sfxCorrect();
    currentQuiz.correct++;
    word.correctStreak = (word.correctStreak || 0) + 1;
    if (word.correctStreak >= 2) word.level = 'mastered';
    else if (word.correctStreak >= 1) word.level = 'fuzzy';
    currentQuiz.results.push({ word, correct: true });
  } else {
    btn.classList.add('wrong');
    sfxWrong();
    currentQuiz.wrong++;
    word.level = 'weak';
    word.correctStreak = 0;
    allBtns.forEach(b => {
      if (b.textContent === word.japanese) b.classList.add('show-correct');
    });
    currentQuiz.results.push({ word, correct: false });
  }

  saveState();
  setTimeout(() => nextQuestion(), isCorrect ? 600 : 1200);
}

function nextQuestion() {
  // Always cancel speech before transitioning
  if ('speechSynthesis' in window) window.speechSynthesis.cancel();
  currentQuiz.index++;
  if (quizDrillMode) {
    if (currentQuiz.masteredCount >= currentQuiz.totalCount) {
      showResult();
    } else if (currentQuiz.index >= currentQuiz.words.length) {
      showResult();
    } else {
      showQuizQuestion();
    }
  } else {
    if (currentQuiz.index >= currentQuiz.words.length) {
      showResult();
    } else {
      showQuizQuestion();
    }
  }
}

function showResult() {
  // Aggressively stop all speech (iOS needs multiple cancel calls)
  if ('speechSynthesis' in window) {
    window.speechSynthesis.cancel();
    window.speechSynthesis.cancel();
  }
  stopAllAudio();
  showScreen('result');
  // Cancel again after screen transition in case iOS queued speech
  setTimeout(() => {
    if ('speechSynthesis' in window) window.speechSynthesis.cancel();
  }, 100);
  setTimeout(() => {
    if ('speechSynthesis' in window) window.speechSynthesis.cancel();
  }, 500);
  sfxComplete();
  const q = currentQuiz;
  const totalAnswered = quizDrillMode ? q.totalCount : q.words.length;
  const pct = Math.round((q.correct / totalAnswered) * 100);

  let emoji, msg;
  if (pct >= 90) { emoji = ''; msg = ''; }
  else if (pct >= 70) { emoji = ''; msg = ''; }
  else if (pct >= 50) { emoji = ''; msg = ''; }
  else { emoji = ''; msg = ''; }

  // Calculate cumulative counts (all words in active deck) for AFTER
  const allWords = getActiveWords();
  const afterCumulative = { unlearned: 0, weak: 0, fuzzy: 0, mastered: 0 };
  allWords.forEach(w => {
    if (w.level === 'almost') w.level = 'mastered';
    if (afterCumulative[w.level] !== undefined) afterCumulative[w.level]++;
  });

  // Calculate diffs: what changed during this quiz
  const seenWords = new Set();
  const diffs = { unlearned: 0, weak: 0, fuzzy: 0, mastered: 0 };
  q.words.forEach(w => {
    if (seenWords.has(w.english)) return;
    seenWords.add(w.english);
    const before = q.beforeLevels[w.english] || 'unlearned';
    const after = w.level;
    if (before !== after) {
      if (diffs[before] !== undefined) diffs[before]--;
      if (diffs[after] !== undefined) diffs[after]++;
    }
  });

  const levelNames = { unlearned: '', weak: '', fuzzy: '', mastered: '' };
  const levelColors = { unlearned: 'var(--gray-400)', weak: 'var(--red-500)', fuzzy: 'var(--yellow-500)', mastered: 'var(--green-500)' };
  const levelOrder = ['mastered', 'fuzzy', 'weak', 'unlearned'];

  const totalWords = allWords.length || 1;

  // Build level change bars with animation data
  let levelChangeHtml = '<div class="level-change-section">';
  levelChangeHtml += '<h4></h4>';
  levelOrder.forEach((level, idx) => {
    const count = afterCumulative[level];
    const diff = diffs[level];
    const diffStr = diff > 0 ? `<span class="lc-diff plus">+${diff}</span>` : diff < 0 ? `<span class="lc-diff minus">${diff}</span>` : `<span class="lc-diff"></span>`;
    const barWidth = Math.round((count / totalWords) * 100);
    // Before width for animation
    const beforeCount = count - diff;
    const beforeWidth = Math.round((beforeCount / totalWords) * 100);
    levelChangeHtml += `
      <div class="lc-row" style="animation-delay:${idx * 0.15}s">
        <div class="lc-label">${levelNames[level]}</div>
        <div class="lc-bar-wrap">
          <div class="lc-bar" data-before="${beforeWidth}" data-after="${barWidth}" style="width:${beforeWidth}%;background:${levelColors[level]}">
            <span class="lc-count" data-from="${beforeCount}" data-to="${count}">${beforeCount}</span>
          </div>
        </div>
        ${diffStr}
      </div>
    `;
  });
  levelChangeHtml += '</div>';

  // Missed words
  const missed = q.results.filter(r => !r.correct);
  const seenMissed = new Set();
  const uniqueMissed = missed.filter(r => {
    if (seenMissed.has(r.word.english)) return false;
    seenMissed.add(r.word.english);
    return true;
  });

  let missedHtml = '';
  if (uniqueMissed.length > 0) {
    missedHtml = `
      <div class="missed-section">
        <h4>${uniqueMissed.length}</h4>
        <div class="missed-list">
          ${uniqueMissed.map(r => {
            const engEsc = escapeHtml(r.word.english).replace(/'/g, "\\'");
            const jpnEsc = escapeHtml(r.word.japanese).replace(/'/g, "\\'");
            return `
            <div class="missed-item">
              <span class="missed-eng" onclick="speakText('${engEsc}')" style="cursor:pointer;">${escapeHtml(r.word.english)}</span>
              <span class="missed-jpn" onclick="speakText('${jpnEsc}')" style="cursor:pointer;">${escapeHtml(r.word.japanese)}</span>
            </div>
          `}).join('')}
        </div>
      </div>
    `;
  }

  document.getElementById('resultContent').innerHTML = `
    <button class="result-close-btn" onclick="showScreen('dashboard'); renderDeckList(); updateDashboard();"></button>
    <div class="result-icon">${emoji}</div>
    <h2>${msg}</h2>
    <p>${totalAnswered} ${q.correct}</p>
    <div class="result-stats">
      <div class="result-stat">
        <div class="num" style="color:var(--green-500)">${q.correct}</div>
        <div class="label"></div>
      </div>
      <div class="result-stat">
        <div class="num" style="color:var(--red-500)">${q.wrong}</div>
        <div class="label"></div>
      </div>
      <div class="result-stat">
        <div class="num" style="color:var(--orange-500)">${pct}%</div>
        <div class="label"></div>
      </div>
    </div>
    ${levelChangeHtml}
    <button class="result-btn next-quiz-btn" onclick="startNextQuiz()"> </button>
    ${missedHtml}
    ${uniqueMissed.length > 0 ? '<button class="result-btn review-btn" onclick="startMissedReview()"></button>' : ''}
  `;

  // Animate bars and counters after render
  setTimeout(() => animateLevelBars(), 400);
}

function animateLevelBars() {
  document.querySelectorAll('.lc-bar').forEach(bar => {
    const beforeW = parseInt(bar.dataset.before);
    const afterW = parseInt(bar.dataset.after);
    bar.style.transition = 'width 0.8s cubic-bezier(0.4, 0, 0.2, 1)';
    bar.style.width = afterW + '%';

    // Animate counter
    const countEl = bar.querySelector('.lc-count');
    if (countEl) {
      const from = parseInt(countEl.dataset.from);
      const to = parseInt(countEl.dataset.to);
      if (from !== to) {
        const duration = 800;
        const start = performance.now();
        function tick(now) {
          const t = Math.min((now - start) / duration, 1);
          const ease = 1 - Math.pow(1 - t, 3);
          countEl.textContent = Math.round(from + (to - from) * ease);
          if (t < 1) requestAnimationFrame(tick);
        }
        requestAnimationFrame(tick);
      }
    }
  });

  // Animate diff badges
  document.querySelectorAll('.lc-diff').forEach((el, i) => {
    el.style.animation = `diffPop 0.4s ease ${0.6 + i * 0.15}s both`;
  });
}

function showMissedWords() {
  const missed = currentQuiz.results.filter(r => !r.correct);
  if (missed.length === 0) {
    showToast('');
    return;
  }
  showScreen('wordlist');
  const items = document.getElementById('wordItems');
  document.getElementById('filterTabs').innerHTML = '';
  items.innerHTML = missed.map(r => `
    <div class="word-item" data-eng="${escapeHtml(r.word.english)}" data-jpn="${escapeHtml(r.word.japanese)}" onclick="toggleWordAnswer(this)">
      <div class="level-dot ${r.word.level}"></div>
      <div class="eng">${escapeHtml(r.word.english)}</div>
      <div class="jpn-container"><div class="jpn">${escapeHtml(r.word.japanese)}</div></div>
    </div>
  `).join('');
}

function confirmQuit() {
  confirmAction('', '', function() {
    showScreen('dashboard');
    renderDeckList();
    updateDashboard();
  }, '');
}

// ============ WORD LIST ============
let wordListDeckId = null; // track which deck is shown in word list

function showWordList() {
  wordListDeckId = activeDeckId;
  showScreen('wordlist');
  answersHidden = false;
  questionsHidden = false;
  const abtn = document.getElementById('answerToggleBtn');
  if (abtn) { abtn.textContent = ''; abtn.classList.remove('hiding'); }
  const qbtn = document.getElementById('questionToggleBtn');
  if (qbtn) { qbtn.textContent = ''; qbtn.classList.remove('hiding'); }
  const searchInput = document.getElementById('wordSearchInput');
  if (searchInput) { searchInput.value = ''; }
  document.getElementById('searchClear')?.classList.remove('show');
  currentWordFilter = 'all';
  renderDeckTabs();
  renderFilterTabs();
  renderWordList('all');
}

function renderDeckTabs() {
  const container = document.getElementById('deckTabs');
  container.innerHTML = decks.map(deck => `
    <button class="deck-tab ${deck.id === wordListDeckId ? 'active' : ''}" onclick="switchWordListDeck('${deck.id}', this)">${escapeHtml(deck.name)} (${deck.words.length})</button>
  `).join('');
}

function switchWordListDeck(deckId, el) {
  wordListDeckId = deckId;
  el.parentElement.querySelectorAll('.deck-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  renderFilterTabs();
  renderWordList('all');
}

function getWordListWords() {
  const deck = decks.find(d => d.id === wordListDeckId);
  return deck ? deck.words : [];
}

function renderFilterTabs() {
  const words = getWordListWords();
  const bookmarkedCount = words.filter(w => w.bookmarked).length;
  const counts = { all: words.length, unlearned: 0, weak: 0, fuzzy: 0, mastered: 0 };
  words.forEach(w => {
    if (counts[w.level] !== undefined) counts[w.level]++;
  });

  const tabs = [
    { key: 'all', label: ` (${counts.all})` },
    { key: 'bookmarked', label: ` (${bookmarkedCount})` },
    { key: 'unlearned', label: ` (${counts.unlearned})` },
    { key: 'weak', label: ` (${counts.weak})` },
    { key: 'fuzzy', label: ` (${counts.fuzzy})` },
    { key: 'mastered', label: ` (${counts.mastered})` },
  ];

  document.getElementById('filterTabs').innerHTML = tabs.map((t, i) => `
    <button class="filter-tab ${t.key} ${i === 0 ? 'active' : ''}" onclick="filterWords('${t.key}', this)">${t.label}</button>
  `).join('');
}

let currentWordFilter = 'all';

function onWordSearch() {
  const input = document.getElementById('wordSearchInput');
  const clearBtn = document.getElementById('searchClear');
  clearBtn.classList.toggle('show', input.value.length > 0);
  renderWordList(currentWordFilter);
}

function clearWordSearch() {
  document.getElementById('wordSearchInput').value = '';
  document.getElementById('searchClear').classList.remove('show');
  renderWordList(currentWordFilter);
}

function filterWords(level, el) {
  el.parentElement.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
  el.classList.add('active');
  currentWordFilter = level;
  renderWordList(level);
}

let answersHidden = false;
let questionsHidden = false;

function toggleAllAnswers() {
  answersHidden = !answersHidden;
  const btn = document.getElementById('answerToggleBtn');
  btn.textContent = answersHidden ? '' : '';
  btn.classList.toggle('hiding', answersHidden);
  document.querySelectorAll('#wordItems .jpn').forEach(el => {
    el.classList.toggle('hidden-answer', answersHidden);
  });
}

function toggleAllQuestions() {
  questionsHidden = !questionsHidden;
  const btn = document.getElementById('questionToggleBtn');
  btn.textContent = questionsHidden ? '' : '';
  btn.classList.toggle('hiding', questionsHidden);
  document.querySelectorAll('#wordItems .eng').forEach(el => {
    el.classList.toggle('hidden-question', questionsHidden);
  });
}

function renderWordList(level) {
  currentWordFilter = level;
  const words = getWordListWords();
  let filtered;
  if (level === 'all') filtered = words;
  else if (level === 'bookmarked') filtered = words.filter(w => w.bookmarked);
  else filtered = words.filter(w => w.level === level);

  // Apply search filter
  const query = (document.getElementById('wordSearchInput')?.value || '').trim().toLowerCase();
  if (query) {
    filtered = filtered.filter(w =>
      w.english.toLowerCase().includes(query) || w.japanese.includes(query)
    );
  }

  const items = document.getElementById('wordItems');

  if (filtered.length === 0) {
    items.innerHTML = '<div style="text-align:center;padding:40px;color:var(--gray-400);"></div>';
    return;
  }

  items.innerHTML = filtered.map(w => `
    <div class="word-item" data-eng="${escapeHtml(w.english)}" data-jpn="${escapeHtml(w.japanese)}">
      <div class="level-dot ${w.level}"></div>
      <div class="eng ${questionsHidden ? 'hidden-question' : ''}" onclick="onTapEng(this.parentElement)">${escapeHtml(w.english)}</div>
      <div class="jpn-container" onclick="onTapJpn(this.parentElement)"><div class="jpn ${answersHidden ? 'hidden-answer' : ''}" data-answer="${escapeHtml(w.japanese)}">${escapeHtml(w.japanese)}</div></div>
    </div>
  `).join('');
}

function onTapEng(el) {
  const eng = el.querySelector('.eng');
  if (!eng) return;
  if (questionsHidden && eng.classList.contains('hidden-question')) {
    eng.classList.remove('hidden-question');
    speakText(el.dataset.eng);
  } else if (questionsHidden && !eng.classList.contains('hidden-question')) {
    eng.classList.add('hidden-question');
  } else {
    speakText(el.dataset.eng);
  }
}

function onTapJpn(el) {
  const jpn = el.querySelector('.jpn');
  if (!jpn) return;
  if (answersHidden && jpn.classList.contains('hidden-answer')) {
    jpn.classList.remove('hidden-answer');
    speakText(el.dataset.jpn);
  } else if (answersHidden && !jpn.classList.contains('hidden-answer')) {
    jpn.classList.add('hidden-answer');
  } else {
    speakText(el.dataset.jpn);
  }
}

// Speak two texts in sequence (wait for first to finish)
function speakTextSequence(text1, text2) {
  if (soundMuted || !('speechSynthesis' in window)) return;
  window.speechSynthesis.cancel();
  
  const speak = (text, onEnd) => {
    let cleanText = text.replace(/[\u{1F000}-\u{1FFFF}]/gu, '').trim();
    if (!cleanText || /^[\d\s.,:;!?()\/\-]+$/.test(cleanText)) {
      if (onEnd) onEnd();
      return;
    }
    const lang = detectLang(cleanText);
    const langMap = { en: 'en-US', ja: 'ja-JP', ko: 'ko-KR', zh: 'zh-CN', fr: 'fr-FR', de: 'de-DE', es: 'es-ES' };
    const u = new SpeechSynthesisUtterance(cleanText);
    u.lang = langMap[lang] || 'en-US';
    u.rate = lang === 'en' ? 0.85 : 1.0;
    u.volume = 0.45;
    if (ttsVoiceCache[lang]) u.voice = ttsVoiceCache[lang];
    
    // iOS keepAlive workaround
    let iosKeepAlive = setInterval(() => {
      if (!window.speechSynthesis.speaking) {
        clearInterval(iosKeepAlive);
      } else {
        window.speechSynthesis.pause();
        window.speechSynthesis.resume();
      }
    }, 5000);
    
    u.onend = () => { clearInterval(iosKeepAlive); if (onEnd) setTimeout(onEnd, 300); };
    u.onerror = () => { clearInterval(iosKeepAlive); if (onEnd) onEnd(); };
    window.speechSynthesis.speak(u);
  };

  speak(text1, () => speak(text2, null));
}

// ============ WORD EDITOR ============
let editingWordIndex = null;
let editorSearchQuery = '';

function showWordEditor() {
  showScreen('word-editor');
  editorSearchQuery = '';
  const si = document.getElementById('editorSearchInput');
  if (si) si.value = '';
  document.getElementById('editorSearchClear')?.classList.remove('show');
  renderEditorList();
}

function onEditorSearch() {
  const input = document.getElementById('editorSearchInput');
  const clearBtn = document.getElementById('editorSearchClear');
  editorSearchQuery = (input?.value || '').trim().toLowerCase();
  clearBtn?.classList.toggle('show', editorSearchQuery.length > 0);
  renderEditorList();
}

function clearEditorSearch() {
  document.getElementById('editorSearchInput').value = '';
  editorSearchQuery = '';
  document.getElementById('editorSearchClear')?.classList.remove('show');
  renderEditorList();
}

function renderEditorList() {
  const words = getActiveWords();
  const el = document.getElementById('editorWordList');
  if (words.length === 0) {
    el.innerHTML = '<div style="text-align:center;padding:40px;color:var(--gray-400);"></div>';
    return;
  }

  // Build index-mapped filtered list
  let items = words.map((w, i) => ({ w, i }));
  if (editorSearchQuery) {
    items = items.filter(({ w }) =>
      w.english.toLowerCase().includes(editorSearchQuery) ||
      w.japanese.toLowerCase().includes(editorSearchQuery)
    );
  }

  if (items.length === 0) {
    el.innerHTML = '<div style="text-align:center;padding:30px;color:var(--gray-400);font-size:13px;"></div>';
    return;
  }

  el.innerHTML = items.map(({ w, i }) => `
    <div class="editor-word-item" data-index="${i}" onclick="showEditWordModal(${i})">
      <div class="ew-inner">
        <div class="ew-content">
          <div class="ew-eng">${escapeHtml(w.english)}</div>
          <div class="ew-jpn">${escapeHtml(w.japanese)}</div>
        </div>
      </div>
    </div>
  `).join('');
}

// --- Add word with position ---
function addWordDirect() {
  editingWordIndex = null;
  document.getElementById('editWordTitle').textContent = '';
  document.getElementById('editWordEng').value = '';
  document.getElementById('editWordJpn').value = '';

  // Hide delete button for new word
  document.getElementById('editWordDeleteRow').style.display = 'none';

  // Show position selector
  const posRow = document.getElementById('insertPositionRow');
  const posSel = document.getElementById('insertPosition');
  posRow.style.display = 'block';
  const words = getActiveWords();
  let options = '<option value="0"></option>';
  words.forEach((w, i) => {
    const label = w.english.length > 20 ? w.english.slice(0, 20) + '' : w.english;
    options += `<option value="${i + 1}">${i + 1}. ${escapeHtml(label)} </option>`;
  });
  posSel.innerHTML = options;
  posSel.value = String(words.length); // default: 

  const overlay = document.getElementById('editWordOverlay');
  overlay.classList.add('show');
  setTimeout(() => document.getElementById('editWordEng').focus(), 300);
}

function showAddWordModal() {
  addWordDirect();
}

function showEditWordModal(index) {
  const words = getActiveWords();
  const word = words[index];
  if (!word) return;
  editingWordIndex = index;
  document.getElementById('editWordTitle').textContent = '';
  document.getElementById('editWordEng').value = word.english;
  document.getElementById('editWordJpn').value = word.japanese;

  // Show position selector for moving
  const posRow = document.getElementById('insertPositionRow');
  const posSel = document.getElementById('insertPosition');
  posRow.style.display = 'block';
  let options = '<option value="0"></option>';
  words.forEach((w, i) => {
    const label = w.english.length > 20 ? w.english.slice(0, 20) + '' : w.english;
    options += `<option value="${i + 1}">${i + 1}. ${escapeHtml(label)} </option>`;
  });
  posSel.innerHTML = options;
  posSel.value = String(index === 0 ? 0 : index);

  // Show delete button for editing
  document.getElementById('editWordDeleteRow').style.display = 'block';

  const overlay = document.getElementById('editWordOverlay');
  overlay.classList.add('show');
  setTimeout(() => document.getElementById('editWordEng').focus(), 300);
}

function closeEditWord() {
  document.getElementById('editWordOverlay').classList.remove('show');
}

function saveWord() {
  const eng = document.getElementById('editWordEng').value.trim();
  const jpn = document.getElementById('editWordJpn').value.trim();
  if (!eng || !jpn) {
    showToast('');
    return;
  }
  const words = getActiveWords();
  const targetPos = parseInt(document.getElementById('insertPosition').value) || 0;

  if (editingWordIndex === null) {
    // Add new word at selected position
    const newWord = { english: eng, japanese: jpn, level: 'unlearned', correctStreak: 0 };
    words.splice(targetPos, 0, newWord);
    showToast('');
  } else {
    // Edit existing word
    words[editingWordIndex].english = eng;
    words[editingWordIndex].japanese = jpn;

    // Move if position changed
    const currentPos = editingWordIndex;
    // "targetPos" means "insert after position targetPos-1", i.e. at index targetPos
    // But we need to account for the item being removed first
    if (targetPos !== currentPos && targetPos !== currentPos + 1) {
      const [moved] = words.splice(currentPos, 1);
      const insertAt = targetPos > currentPos ? targetPos - 1 : targetPos;
      words.splice(insertAt, 0, moved);
      showToast('');
    } else {
      showToast('');
    }
  }
  saveState();
  closeEditWord();
  renderEditorList();
}

function deleteWord(index) {
  const words = getActiveWords();
  const word = words[index];
  confirmAction('', `${word.english}`, function() {
    words.splice(index, 1);
    saveState();
    renderEditorList();
    showToast('');
  }, '');
}

function deleteEditingWord() {
  if (editingWordIndex === null) return;
  const idx = editingWordIndex;
  closeEditWord();
  deleteWord(idx);
}

// ============ RESET ============
// ============ CONFIRM MODAL ============
let pendingConfirmAction = null;

function confirmAction(title, desc, action, btnLabel) {
  // Ensure the confirm modal structure is intact before using it
  if (!document.getElementById('confirmTitle')) {
    const modal = document.querySelector('#confirmOverlay .confirm-modal');
    if (modal) {
      modal.innerHTML = `
        <div class="confirm-icon"></div>
        <h3 id="confirmTitle"></h3>
        <p id="confirmDesc"></p>
        <div class="confirm-buttons">
          <button class="confirm-cancel" onclick="closeConfirm()"></button>
          <button class="confirm-danger" id="confirmDangerBtn"></button>
        </div>
      `;
    }
  }
  const titleEl = document.getElementById('confirmTitle');
  const descEl = document.getElementById('confirmDesc');
  const btn = document.getElementById('confirmDangerBtn');
  if (!titleEl || !descEl || !btn) return; // Safety check
  
  titleEl.textContent = title;
  descEl.textContent = desc;
  btn.textContent = btnLabel || '';
  pendingConfirmAction = action;
  btn.onclick = function() {
    const actionToRun = pendingConfirmAction;
    closeConfirm();
    if (actionToRun) actionToRun();
  };
  document.getElementById('confirmOverlay').classList.add('show');
}

function closeConfirm() {
  document.getElementById('confirmOverlay').classList.remove('show');
  pendingConfirmAction = null;
  // Restore original confirm modal structure (may have been replaced by import modal)
  const modal = document.querySelector('#confirmOverlay .confirm-modal');
  if (!document.getElementById('confirmTitle')) {
    modal.innerHTML = `
      <div class="confirm-icon"></div>
      <h3 id="confirmTitle"></h3>
      <p id="confirmDesc"></p>
      <div class="confirm-buttons">
        <button class="confirm-cancel" onclick="closeConfirm()"></button>
        <button class="confirm-danger" id="confirmDangerBtn"></button>
      </div>
    `;
  }
  window._importData = null;
}

// Close all overlays - used after import to ensure clean state on iOS
function closeAllOverlays() {
  const overlayIds = ['confirmOverlay', 'renameOverlay', 'helpOverlay', 'demoPickerOverlay', 'celebrationOverlay', 'editWordOverlay', 'reorderOverlay', 'deckEditOverlay'];
  overlayIds.forEach(id => {
    const el = document.getElementById(id);
    if (el) el.classList.remove('show');
  });
  pendingConfirmAction = null;
  window._importData = null;
  // Restore confirm modal structure if needed
  const modal = document.querySelector('#confirmOverlay .confirm-modal');
  if (modal && !document.getElementById('confirmTitle')) {
    modal.innerHTML = `
      <div class="confirm-icon"></div>
      <h3 id="confirmTitle"></h3>
      <p id="confirmDesc"></p>
      <div class="confirm-buttons">
        <button class="confirm-cancel" onclick="closeConfirm()"></button>
        <button class="confirm-danger" id="confirmDangerBtn"></button>
      </div>
    `;
  }
}

function doResetCurrentDeck() {
  const deck = getActiveDeck();
  if (!deck) return;
  deck.words.forEach(w => { w.level = 'unlearned'; w.correctStreak = 0; });
  saveState();
  renderDeckList();
  updateDashboard();
  showToast('' + deck.name + '');
}

function doResetAll() {
  // Clean up per-deck settings
  decks.forEach(d => {
    try { localStorage.removeItem('mikan_deckSettings_' + d.id); } catch(e) {}
  });
  decks = [];
  activeDeckId = null;
  localStorage.removeItem('mikan_decks');
  localStorage.removeItem('mikan_activeDeck');
  showScreen('import');
  showToast('');
}

// ============ EXPORT / IMPORT ============
function exportAllData() {
  if (decks.length === 0) {
    showToast('');
    return;
  }
  const data = {
    version: 1,
    app: 'CSVocab',
    exportedAt: new Date().toISOString(),
    activeDeckId: activeDeckId,
    decks: decks
  };
  const json = JSON.stringify(data, null, 2);
  const blob = new Blob([json], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const date = new Date().toISOString().slice(0, 10);
  a.href = url;
  a.download = `csvocab_backup_${date}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
  showToast(' ');
}

function importAllData(event) {
  const fileInput = event.target;
  const file = fileInput.files[0];
  if (!file) return;

  // iOS Safari fix: aggressively reset file input to prevent phantom overlay blocking touches
  fileInput.value = '';
  fileInput.blur();
  if (document.activeElement === fileInput) {
    document.activeElement.blur();
  }

  const reader = new FileReader();
  reader.onload = function(e) {
    // iOS Safari fix: ensure no element retains focus that could block interactions
    if (document.activeElement && document.activeElement !== document.body) {
      document.activeElement.blur();
    }

    try {
      const data = JSON.parse(e.target.result);

      // Validate
      if (!data.decks || !Array.isArray(data.decks)) {
        showToast(' ');
        return;
      }

      // Check each deck has required fields
      for (const deck of data.decks) {
        if (!deck.id || !deck.name || !Array.isArray(deck.words)) {
          showToast(' ');
          return;
        }
      }

      // Ask user how to import
      const existingCount = decks.length;
      if (existingCount > 0) {
        showImportChoiceModal(data);
      } else {
        // No existing data, just load
        applyImportData(data, 'replace');
      }
    } catch (err) {
      showToast(' JSON');
    }
  };
  reader.readAsText(file);
}

function showImportChoiceModal(data) {
  const deckNames = data.decks.map(d => d.name).join('');
  const overlay = document.getElementById('confirmOverlay');
  const modal = overlay.querySelector('.confirm-modal');
  modal.innerHTML = `
    <div class="confirm-icon"></div>
    <h3></h3>
    <p style="font-size:13px;color:var(--gray-500);margin:8px 0 4px;">: ${escapeHtml(deckNames)}</p>
    <p style="font-size:12px;color:var(--gray-400);margin-bottom:16px;">${data.decks.length}${data.decks.reduce((s,d) => s + d.words.length, 0)}</p>
    <div class="confirm-buttons" style="flex-direction:column;gap:8px;">
      <button class="confirm-danger" style="background:var(--orange-500);box-shadow:0 4px 12px rgba(255,140,0,0.3);" id="importMergeBtn">
        
      </button>
      <button class="confirm-danger" style="background:var(--red-500);box-shadow:0 4px 12px rgba(239,68,68,0.3);" id="importReplaceBtn">
        
      </button>
      <button class="confirm-cancel" onclick="closeConfirm();"></button>
    </div>
  `;
  window._importData = data;
  
  // Use addEventListener instead of inline onclick for more reliable iOS behavior
  document.getElementById('importMergeBtn').addEventListener('click', function() {
    const d = window._importData;
    closeConfirm();
    if (d) applyImportData(d, 'merge');
  });
  document.getElementById('importReplaceBtn').addEventListener('click', function() {
    const d = window._importData;
    closeConfirm();
    if (d) applyImportData(d, 'replace');
  });
  
  overlay.classList.add('show');
}

function applyImportData(data, mode) {
  if (mode === 'replace') {
    decks = data.decks;
    activeDeckId = data.activeDeckId || (decks.length > 0 ? decks[0].id : null);
  } else {
    // Merge: add new decks, update existing by ID
    const existingIds = new Set(decks.map(d => d.id));
    for (const importDeck of data.decks) {
      const existing = decks.find(d => d.id === importDeck.id);
      if (existing) {
        // Update existing deck
        existing.name = importDeck.name;
        existing.words = importDeck.words;
      } else {
        decks.push(importDeck);
      }
    }
    if (!activeDeckId && decks.length > 0) {
      activeDeckId = decks[0].id;
    }
  }

  saveState();
  renderDeckList();
  updateDashboard();
  showToast(' ' + data.decks.length + '');
  window._importData = null;

  // iOS Safari fix: ensure all overlays are properly closed after import
  closeAllOverlays();
  
  // iOS Safari fix: reset any lingering focus/touch state
  if (document.activeElement && document.activeElement !== document.body) {
    document.activeElement.blur();
  }
}

// ============ TOAST ============
function showToast(msg) {
  const toast = document.getElementById('toast');
  toast.textContent = msg;
  toast.classList.add('show');
  setTimeout(() => toast.classList.remove('show'), 2500);
}

// ============ INIT ============
loadState();

// ============ PWA SERVICE WORKER ============
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js').then(() => {
    console.log('SW registered');
  }).catch(err => console.log('SW error:', err));
}
</script>
</body>
</html>
